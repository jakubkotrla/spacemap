\section{Gravitaèní model}Inspirováni pouitím odpudivosti v pøedchozím modelu, rozhodli jsme se vytvoøit model zaloenı pouze na pøitalivosti a odpudivosti.Tedy uzly mapy jsou pøitahovány k pøemìtùm a zároveò se vzájemnì odpuzují. Obì síly berou v potaz naplnìnost uzlu.\\Model dále obsahuje myšlenku, e i kdy èlovìk vnímá pøedmìty v jeden okamik, ukládání do pamìti probíhá postupnì. Tato myšlenka je do modelu zapracována tak, e vjem je sice dodán prostorové mapì v jeden konkrétní krok simulace,ale mapa si jej uloí a uèí se dle nìj nìkolik následujících krokù.\\\subsection{Vytvoøení vrstvy uzlù}Na zaèátku simulace si agent vytvoøí ??prvotní?? prostorovou mapu, která neobsahuje ádné informace o pøedmìtech ani jejich rozloení ve svìtì.Obsahuje uzly, rozmístìné pouze dle geometrie místnosti. Jejich poèet a zpùsob rozloení je parametrizován.\\\begin{definition}[Poèáteèní odchylka mapy]Uzly mohou bıt umístìny zcela náhodnì èi pravidelnì ve ètvercové møíce s náhodnou odchylkou.Náhodná odchylka mùe bıt i nulová, èím je dosaeno pravidelného rozloení uzlù.Ukázky poèáteèního rozloení uzlù jsou na obrázku \ref{fig:createmap}.Ukázalo se, e tento parametr nemá vliv na rozloení uzlù po delší dobì simulace.\end{definition}\begin{figure}[h!]  \centering  \subfloat[Pravidelná møíka]{\label{fig:createmap-grid}\includegraphics[width=0.33\textwidth]{img/createmap/nodes-start-grid.eps}}  \subfloat[Pravidelná møíka s odchylkou 3]{\label{fig:createmap-noise3}\includegraphics[width=0.33\textwidth]{img/createmap/nodes-start-grid-noise-3.eps}}  \subfloat[Zcela náhodnì]{\label{fig:createmap-random}\includegraphics[width=0.33\textwidth]{img/createmap/nodes-start-random.eps}}  \caption{Poèáteèní rozloení uzlù. Další ukázky jsou na pøiloeném CD v adresáøi ??}  \label{fig:createmap}\end{figure}\begin{definition}[Hustota mapy]Poèet uzlù, které jsou do místnosti umístìny pøi vytváøení mapy je urèen pouze na základì její velikosti a hustoty mapy.Pokud je poèáteèní rozloení mapy pravidelná møíka, hustota mapy urèuje, jak daleko od sebe mají dva uzly bıt.Jeden uzel pak pokrıvá oblast velikosti ètverce hustoty.Pokud je rozloení uzlù zcela náhodné, je z hustoty mapy odvozen poèet uzlù dle vzorce \eqref{formula:el-start-pocet-uzlu},kde $obsah(mistnost)$ je obsah polygonu reprezentující místnost a $hustota$ je hustota mapy.\end{definition}\begin{equation} pocet = \frac{obsah(mistnost)}{hustota^2}\label{formula:el-start-pocet-uzlu}\end{equation}\\% STOPA VJEMU %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\subsection{Stopa vjemu}Gravitaèní model se uèí z vjemù postupnì.K tomu vyuívá tzv. \emph{stopy vjemu}.Pøedstavují urèitou míru pozornosti, kterou agent vìnuje jednomu pøedmìtu, krátkodobì uloenı vjem, kterı chvíli trvá a prostorovou mapu postupnì mìní.\\\begin{definition}[Stopa vjemu]Kdy je v urèitém kroku simulace prostorové mapì pøedán vjem ke zpracování, mapa si jej uloí a uèí se dle nìj nekolik dalších krokù simulace.Takto uloenı vjem budeme nazıvat stopou vjemu.Stopa vjemu je dvojice \emph{$<$pamìová stopa, intenzita$>$}, kde \emph{pamìová stopa}, je pamìová stopa pøedmìtu, kterı vjem vyvolal.Intenzita stopy vjemu je pøi jejím vytvoøení odvozena z intenzity vjemu a v prùbìhu èasu klesá.Intenzita urèuje míru, s jakou bude stopa vjemu ovlivòovat prostorovou mapu.\end{definition}\begin{definition}[Vliv vjemu]Pøi vytvoøení stopy vjemu je urèena její intenzita. Ta závisí na intenzitì pùvodního vjemu a tzv. vlivu vjemu.To je parametr modelu, kterı ovlivòuje rychlost uèení prostorové mapy. Budeme jej dále znaèit $\eta_0$.(EPCreateEnergy)\end{definition}Stopa vjemu postupnì slábne. Typicky bìhem nìkolika krokù simulace klesne její intenzita z poèáteèní hodnoty blízko k nule.Slábnutí stopy závisí na dvou parametrech: \emph{míøe slábnutí} a \emph{limitu zmizení}.\begin{definition}[Míra slabnutí]Míra slábnutí urèuje rychlost klesání intenzity. Ovlivòuje, jak dlouho je stopa vjemu uloena.(EPFadeCoef)\end{definition}\begin{definition}[Limit zmizení]Stopa vjemu zmizí, pokud její intenzita klesne pod urèitou hranici - limit zmizení.(EPFadeLimit)\end{definition}Zpracování pøíchozího vjemu je tedy pouze vytvoøení stopy vjemu s odkazem na pamìovou stopu.Pokud v daném místì ji stopa vjemu je, její intenzita je zvıšena. Poèáteèní intenzita stopy resp. zvıšení intenzity je dáno vzorcem:\begin{equation} \eta(stopa) = \eta_0 \times \eta(vjem)\label{formula:el-stopa-start-int}\end{equation}\\\begin{definition}[Dosah pøitalivosti]Parametr modelu dosah pøitalivosti urèuje, na jakou vzdálenost jsou pøitahovány uzly mapy k stopám vjemu. Vzdálenìjší uzly nejsou pøitahovány.(ELGravityRange)\end{definition}Jeden krok simulace stopy vjemu je popsán v algoritmu \ref{alg:stopa-step}. V jeho prvním kroku je zkonstruována mnoina okolních uzlù:\begin{equation} nodes_{around} = \{ n \in nodes ; dist(n, stopa) < dosah_{pritazlivost} \}\label{formula:el-okolni-uzly-g}\end{equation}\begin{algorithm}[h!]\caption{Jeden krok simulace pro stopu vjemu}\label{alg:stopa-step}\begin{algorithmic}[1]\State $nodes_{around} \gets$ všechny uzly v okolí stopy\ForAll{$node \in nodes_{around}$}	\State $node_{xy} \gets node_{xy} + \Delta_{xy}$ dle vzorce \eqref{formula:el-ep-gravitace} \label{alg:ep-step-gravitace}\EndFor\ForAll{$node \in nodes_{around}$}	\State $\Delta \eta \gets \eta(node, bod)$ dle vzorce \eqref{formula:el-intenzita} \label{alg:ep-step-intenzita}	\State zvıšení intenzity vazby mezi $node$ a pamìovou stopou pøedmìtu o $\Delta \eta$\EndFor\State $\eta(stopa) \gets \eta(stopa) \times$ EPFadeCoef\If{$\eta(stopa) <$ EPFadeLimit}	\State zmizení stopy vjemu\EndIf\end{algorithmic}\end{algorithm}Na øádku \ref{alg:ep-step-intenzita} je zvıšena intenzita vazby mezi uzlem a pamìovou stopu.Zvıšení je dáno podobnım vzorcem jako \eqref{formula:intenzita-vazby} s jedinım rozdílem, e místo vjemu se pracuje s jeho stopou:\begin{equation} \Delta \eta(node, bod) = \eta(stopa) \times \frac{ norm( dist(node, stopa) ) }{\sum_{n \in nodes_{around}}  norm( dist(n, stopa) )}\label{formula:el-intenzita}\end{equation}\\kde $nodes_{around}$ je mnoina všech uzlù v okolí stopy vjemu.Funkce $norm$ je libovolná klesající funkce mající obor hodnot $<0,1>$, napø. nepøímá úmìra $norm(x) = 1/max(1,x)$ èi Gaussova funkce.\\Na øádku \ref{alg:ep-step-gravitace} je pouita zmìna polohy uzlu $\Delta_{xy}$, je dána vzorcem:\begin{equation} \Delta_{xy}(node, stopa) = \frac{\eta(stopa)}{\eta_0} \times \frac{ sila_{pritazlivost} }{ dist(node, stopa)^2 \times \mu(node) }\label{formula:el-ep-gravitace}\end{equation}\\% ODPUDIVOST UZLU %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\subsection{Odpudivost uzlù}V kadém kroku simulace se uzly, které jsou pøíliš blízko u sebe, odpuzují.\begin{definition}[Dosah odpudivosti]Parametr modelu dosah odpudivosti urèuje, na jakou vzdálenost se uzly mapy ještì odpuzují. Vzdálenìjší uzly se neodpuzují.(ELAntigravityRange)\end{definition}\begin{definition}[Síla odpudivosti]Parametr modelu síla odudivosti urèuje, jak moc se uzly mapy odpuzují. Pùsobí jako opak síly pøitalivosti.(ELAntigravityRange)\end{definition}\begin{definition}[Vliv naplnìnosti]Parametr modelu vliv naplnìnosti urèuje, jak velkı vliv má naplnìnost uzlu na jeho odpudivost s ostatními uzly.(ELAntigravityRange)\end{definition}Zmìna polohy uzlu kvùli odpudivosti je souèet odpudivıch sil okolních uzlù a je nepøímo úmìrná naplnìnosti uzlu.Nejdøíve jsou urèeny okolní uzly jako mnoina:\begin{equation} nodes_{around} = \{ n \in nodes ; dist(n, stopa) < dosah_{odpudivost} \}\label{formula:el-okolni-uzly-ag}\end{equation}Pro všechny okolní uzly je spoètena vzájemná odpudivost dle vzorce:\begin{equation} odpudivost(n_i, n_j) = \frac{ sila_{odpudivost} }{ dist(n_i, n_j)^2 \times \mu(n_i) \times \mu(n_j) } \label{formula:el-odpudivost}\end{equation}\\Naplnìnost uzlù musí bıt minimálnì 0,8 a celı jmenovatel ve vzorci \eqref{ormula:el-odpudivost} musí bıt minimálnì 0,64.K tomu je vyuita funkce $max$, kterou pro pøehlednost ve vzorci není.Zabráníme tak dìlení nulou a pøíliš velkım hodnotám odpudivosti, kdy by se jmenovatel bllíil nule.\\Po urèení všech odpudivıch sil, které na uzly pùsobí, jsou polohy uzlù upraveny dle tìchto sil a jejich aktuální naplnìnosti:\begin{equation} \Delta_{xy}(node) = \frac{\sum_{\substack{   n \in nodes  }}  odpudivost(n, node)}{ max(1, \mu(node)) } \label{formula:el-odpudivost}\end{equation}\\Funkce $max$ je ve vzorci pouita, aby zabránila dìlení nulou a pøíliš velkım zmìnám polohy uzlù pro $\mu(node) \to 0$.Pøesto je moné, e se v jednom kroku simulace nasèítají takové odpudivé a pøitalivé síly, e by zmìna polohy uzlu mohla pøesáhnout rozumnou mez.Nechceme, aby kvùli krátkodobım stavùm sítì \footnote{napø. pøi vytvoøení nového uzlu prostorové mapy} uzly pøíliš mìnily svou polohu.Pøidali jsme tedy omezení na maximální monı pohyb uzlu - parametr modelu MaxELNodeMove.Alternativní øešení by bylo zmenšit parametr ELAntigravityCoef a ELGravityCoef a provést více iterací algoritmu \ref{alg:ep-step}. To jevšak velmi nároèné na vıkon a vıše uvedené øešení toto vlastnì imituje.\\\subsection{Omezení pohybu uzlù}Následkem odpudivosti uzlù je moné, e se model bude snait pøesunout uzel mimo svìt, resp. vnì polygonu svìt reprezentující.V tom pøípadì je uzel na okraj svìta, tj. na hranu polygonu v místì jejího prùseèíku s úseèkou pøedstavující plánovanou trajektorií uzlu.Pokud se v dalších krocích simulace bude model opìt snait pøesunout uzel vnì polygonu, bude jeho trajektorie promítnuta na hranu polygonu, na které uzel leí.Uzel tak bude "klouzat" po hranì polygonu, jak je ukázáno na obrázku \ref{fig:slide-on-edge}.\\\begin{figure}[h]  \centering  \scalebox{0.8}{\includegraphics{img/slide-on-edge.ps}}  \caption{Zmìna posunu uzlu, kdy narazí na hranu polygonu}  \label{fig:slide-on-edge}\end{figure}% ZMENA POCTU UZLU %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\subsection{Zmìna poètu uzlù}Je ádoucí, aby se poèet uzlù prostorové mapy v prùbìhu simulace mìnil, dle poètu pøedmìtù, které agent vidìl.Mapa tedy vytváøí nové uzly a zapomíná existující uzly. Pro tuto funkènost jsme definovali nìkolik pojmù.\\\begin{definition}[Chtìnı poèet uzlù]Ze vzorce \eqref{formula:el-start-pocet-uzlu} je urèen poèáteèní poèet uzlù.Chtìnı poèet uzlù $n_{desired}$ je poèet uzlù, které by v prostoru mìly bıt, urèenı jen dle jeho velikosti.Je to konstanta, dvojnásobek poètu uzlù, které jsou do prostoru umístìny na zaèátku.\end{definition}\begin{definition}[Cena pøidání uzlu]\end{definition}Cena za pøidání uzlu $cost_{create}$ resp. cena za zapomenutí uzlu $cost_{delete}$ je funkce $n_{desired}$ a aktuálního poètu uzlù $n_{current}$.Jsou urèeny vzorcem:\begin{equation} cost_{create}(n_{desired}, n_{current}) = 100 \times 3^{ \frac{n_{diff}}{50} }\label{formula:cost-create}\end{equation}resp.\begin{equation} cost_{delete}(n_{desired}, n_{current}) = 100 \times 3^{ - \frac{n_{diff}}{50} }\label{formula:cost-delete}\end{equation}\\$n_{diff}$ je promìnná vyjadøující rozdíl mezi aktuálním poètem a chtìnnım poètem uzlù dle vzorce:\begin{equation} n_{diff}(n_{desired}, n_{current}) = NodeCostCoef \times \frac{ n_{current} - n_{desired} }{ n_{desired} }\label{formula:forget-chance}\end{equation}\\?? OBR grafy funkcí ??\\Uzly jsou vytváøeny pøi zpracování vjemu prostorovou mapou. Pravdìpodobnost, e bude uzel vytvoøen, závisí na NodeCreateCost a intenzitì vjemu.Je to podrobnì popsáno v další podkapitole.Zapomenutí uzlu se mùe stát v kadém kroku simulace. Energy Layer akumuluje tzv. energii na zapomínání.Na zaèátku je rovná nule a v prùbìhu simulace roste \footnote{kadı krok je pøièteno mnoství urèené parametrem modelu ELForgetNodeRate}.V kadém kroku je urèena pravdìpodobnost, e bude zapomenut uzel vzorcem:\begin{equation} p_{forget} = \frac{e_{forget} - cost_{delete}}{cost_{delete}}\label{formula:pocet-uzlu}\end{equation}\\?? prepsat na algoritmus ??\\kde $e_{forget}$ je aktuální energie na zapomínání Enery Layer a $cost_{delete}$ je cena za zapomenutí uzlu.Dále je vygenerováno náhodné èíslo $r \in <0,1>$. Pokud je menší ne $p_{forget}$, dojde k zapomenutí uzlu.Energie na zapomínání je sníena o aktuální NodeDeleteCost a je vybrán náhodnı uzel.Ten je odstranìn z prostorové mapy vèetnì všech jeho vazeb na pamìové stopy.\\V ten okamik mùe dojít a typicky dochází k narušení nauèeného rovnomìrného rozloení uzlù v prostoru, smazanı uzel za sebou nechává prázdné místo.Èást prostorové mapy kolem smazaného uzlu by bylo vhodné pøeuèit, pøemistit uzly, aby byly opìt rovnomìrnì rozdìlené.Proto je pøi smazání uzlu provedeno nìkolik lokálních krokù simulace, kdy je provádìno pouze odpuzování uzlù v okolí smazaného uzlu.Velikost okolí, tj. uzly, jejich poloha se mìní, a poèet lokálních krokù simulace jsou parametry modelu.\\\subsection{Hiearchie}Jedním z poadavkù na model vrstvy uzlù je, aby umìl vytváøet hiearchii uzlù. Model musí bıt schopen rozpoznat místa s vyšší hustotou uzlù.\\Uzlùm prostorové mapy pøidáme další vlastnost \emph{AGamount}, mnoství odpudivosti, které uzel za svoji existenci pocítil.Pøi vytvoøení uzlu je nastavena na nulu. V kadém kroku pøi poèítání odpudivıch sil pùsobících na uzel, je zvıšena o:\begin{equation} \Delta_{AGamount}(node) = \sum_{ 	\substack{		n \in nodes	}}  |odpudivost(n, node)|\label{formula:el-agamount}\end{equation}\\Mnoství odpudivosti v uzlu je sledováno a kdy pøekroèí limit danı modelem, parametr HLAGNeeded, algoritmus \ref{alg:hl-create} vytvoøí novı uzel vyšší úrovnì.\\ToDo\\finalni alogoritmus EP\begin{definition}[sum]self.ELNodeAddNoise = 2\end{definition}V kadém kroku simulace je pro kadou stopu vjemu proveden algoritmus \ref{alg:ep-step-final}.\begin{algorithm}[h!]\caption{Jeden krok simulace pro bod energie}\label{alg:ep-step}\begin{algorithmic}[1]\State $p_{create} \gets$ pravdìpodobnost vzniku nového uzlu daná vzorcem \eqref{formula:el-pst-node-create} \label{alg:ep-step-create}\State $r \gets$ náhodné èíslo $r \in <0,1>$\If{$r < p_{create}$}	\State vytvoøení nového uzlu	\State vytvoøení vazby uzlu na pamìovou stopu bodu energie	\State $bod_{energy} \gets bod_{energy} - cost_{create}$ \label{alg:ep-step-cost}\EndIf\State $nodes \gets$ všechny uzly v okolí bodu energie\ForAll{$node \in nodes$}	\State $node_{xy} \gets node_{xy} + \Delta_{xy}$ dle vzorce \eqref{formula:el-ep-gravitace} \label{alg:ep-step-gravitace}\EndFor\ForAll{$node \in nodes$}	\State $\Delta \eta \gets \eta(node, bod)$ dle vzorce \eqref{formula:el-intenzita} \label{alg:ep-step-intenzita}	\State zvıšení intenzity vazby mezi $node$ a pamìovou stopou bodu o $\Delta \eta$\EndFor\State $bod_{energy} \gets bod_{energy} \times$ EPFadeCoef\If{$bod_{energy} <$ EPFadeLimit}	\State zrušení bodu energie\EndIf\end{algorithmic}\end{algorithm}Na øádku \ref{alg:ep-step-create} je pouita pravdìpodobnost vytvoøení nového uzlu z energie bodu. Ta je dána vzorcem:\begin{equation} p_{create}(bod_{energy}, cost_{create}) = \frac{bod_{energy} - cost_{create}}{cost_{create}}\label{formula:el-pst-node-create}\end{equation}\\Cena za vytvoøení uzlu $cost_{create}$ ve vzorci \eqref{formula:el-pst-node-create}a na øádku \ref{alg:ep-step-cost} algoritmu je urèena vzorcem \eqref{formula:cost-create}.pøi vytvoøení uzlu v prùbìhu simulace jako vısledek zpracování vjemu je nastavena dle parametru modelu MemObjIntenseToNewNode.