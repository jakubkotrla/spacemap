\section{Gravitaèní model}Inspirováni pouitím odpudivosti v pøedchozím modelu, rozhodli jsme se vytvoøit model zaloenı pouze na pøitalivosti a odpudivosti.Tedy uzly mapy jsou pøitahovány k pøemìtùm a zároveò se vzájemnì odpuzují. Obì síly berou v potaz naplnìnost uzlu.\\Model dále obsahuje myšlenku, e i kdy èlovìk vnímá pøedmìty v jeden okamik, ukládání do pamìti probíhá postupnì. Tato myšlenka je do modelu zapracována tak, e vjem je sice dodán prostorové mapì v jeden konkrétní krok simulace,ale mapa si jej uloí a uèí se dle nìj nìkolik následujících krokù.\\\subsection{Vytvoøení vrstvy uzlù} \label{chapter-createmap}Na zaèátku simulace si agent vytvoøí prvotní prostorovou mapu, která neobsahuje ádné informace o pøedmìtech ani jejich rozloení ve svìtì.Obsahuje uzly, rozmístìné pouze dle geometrie místnosti. Jejich poèet a zpùsob rozloení je parametrizován.\\\begin{definition}[Hustota mapy]Parametr modelu \param{hustota mapy} urèuje poèet uzlù, které jsou do místnosti umístìny pøi vytváøení mapy.Pokud je poèáteèní rozloení mapy pravidelná møíka, hustota mapy urèuje, jak daleko od sebe mají dva uzly bıt.Jeden uzel pak pokrıvá oblast velikosti ètverce hustoty.\end{definition}\begin{definition}[Poèáteèní odchylka mapy]Parametr modelu \param{poèáteèní odchylka mapy} urèuje zpùsob rozloení poèáteèního uzlù v prostoru.Ukázalo se, e tento parametr nemá vliv na rozloení uzlù po delší dobì simulace\footnote{To je zpùsobeno odpudivostí uzlù}.\end{definition}Uzly mohou bıt umístìny zcela náhodnì èi pravidelnì ve ètvercové møíce s náhodnou odchylkou.Náhodná odchylka mùe bıt i nulová, èím je dosaeno pravidelného rozloení uzlù.Ukázky poèáteèního rozloení uzlù jsou na obrázku \ref{fig:createmap}.Pokud je rozloení uzlù zcela náhodné, je z hustoty mapy odvozen poèet uzlù dle vzorce \eqref{formula:el-start-pocet-uzlu},kde $obsah(mistnost)$ je obsah polygonu reprezentující místnost a $hustota$ je hustota mapy.\begin{equation} pocet = \frac{obsah(mistnost)}{hustota^2}\label{formula:el-start-pocet-uzlu}\end{equation}\\\begin{figure}[h!]  \centering  \subfloat[Pravidelná møíka]{\label{fig:createmap-grid}\includegraphics[width=0.33\textwidth]{img/createmap/nodes-start-grid.eps}}  \subfloat[Pravidelná møíka s odchylkou 3]{\label{fig:createmap-noise3}\includegraphics[width=0.33\textwidth]{img/createmap/nodes-start-grid-noise-3.eps}}  \subfloat[Zcela náhodnì]{\label{fig:createmap-random}\includegraphics[width=0.33\textwidth]{img/createmap/nodes-start-random.eps}}  \caption{Poèáteèní rozloení uzlù. Další ukázky jsou na pøiloeném CD.}  \label{fig:createmap}\end{figure}% STOPA VJEMU %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\subsection{Stopa vjemu}Gravitaèní model se uèí z vjemù postupnì.K tomu vyuívá tzv. \emph{stopy vjemu}.Pøedstavují urèitou míru pozornosti, kterou agent vìnuje jednomu pøedmìtu, krátkodobì uloenı vjem, kterı chvíli trvá a prostorovou mapu postupnì mìní.\\\begin{definition}[Stopa vjemu]Kdy je v urèitém kroku simulace prostorové mapì pøedán vjem ke zpracování, mapa si jej uloí a uèí se dle nìj nekolik dalších krokù simulace.Takto uloenı vjem budeme nazıvat stopou vjemu.Stopa vjemu je dvojice \emph{$<$pamìová stopa, intenzita$>$}, kde \emph{pamìová stopa}, je pamìová stopa pøedmìtu, kterı vjem vyvolal.Intenzita stopy vjemu je pøi jejím vytvoøení odvozena z intenzity vjemu a v prùbìhu èasu klesá.Intenzita urèuje míru, s jakou bude stopa vjemu ovlivòovat prostorovou mapu.\end{definition}\begin{definition}[Vliv vjemu]Pøi vytvoøení stopy vjemu je urèena její intenzita. Ta závisí na intenzitì pùvodního vjemu a tzv. vlivu vjemu.To je parametr modelu, kterı ovlivòuje rychlost uèení prostorové mapy. Budeme jej dále znaèit $\eta_0$.(EPCreateEnergy)\end{definition}Stopa vjemu postupnì slábne. Typicky bìhem nìkolika krokù simulace klesne její intenzita z poèáteèní hodnoty blízko k nule.Jak dlouho stopa v mapì zùstane, závisí na dvou parametrech: \emph{míøe slábnutí} a \emph{limitu zmizení}.\begin{definition}[Míra slabnutí]Parametr modelu \param{míra slábnutí} urèuje rychlost klesání intenzity. Ovlivòuje, jak dlouho stopa vjemu existuje.(EPFadeCoef)\end{definition}\begin{definition}[Limit zmizení]Parametr modelu \param{limit zmizení } urèuje, kdy stopa vjemu zmizí z prostorové mapy.(EPFadeLimit)\end{definition}Zpracování pøíchozího vjemu je tedy pouze vytvoøení stopy vjemu s odkazem na pamìovou stopu.Pokud v daném místì ji stopa vjemu je, její intenzita je zvıšena. Poèáteèní intenzita stopy resp. zvıšení intenzity je dáno vzorcem:\begin{equation} \eta(stopa) = \eta_0 \times \eta(vjem)\label{formula:el-stopa-start-int}\end{equation}\begin{definition}[Dosah pøitalivosti]Parametr modelu \param{dosah pøitalivosti} urèuje, na jakou vzdálenost jsou pøitahovány uzly mapy k stopám vjemu. Vzdálenìjší uzly nejsou pøitahovány.(ELGravityRange)\end{definition}\begin{definition}[Síla pøitalivosti]Parametr modelu \param{síla pøitalivosti} urèuje, jak velkou mírou budou uzly prostorové mapy pøitahovány ke stopì vjemu.(ELGravityCoef)\end{definition}Jeden krok simulace stopy vjemu je popsán v algoritmu \ref{alg:stopa-step}. V jeho prvním kroku je zkonstruována mnoina okolních uzlù:\begin{equation} nodes_{around} = \{ n \in nodes ; dist(n, stopa) < dosah_{pritazlivost} \}\label{formula:el-okolni-uzly-g}\end{equation}\begin{algorithm}[h!]\caption{Jeden krok simulace pro stopu vjemu}\label{alg:stopa-step}\begin{algorithmic}[1]\State $nodes_{around} \gets$ všechny uzly v okolí stopy dle $dosah_{pritazlivost}$\ForAll{$node \in nodes_{around}$}	\State $node_{xy} \gets node_{xy} + \Delta_{xy}$ dle vzorce \eqref{formula:el-ep-gravitace} \label{alg:step-step-gravitace}\EndFor\ForAll{$node \in nodes_{around}$}	\State $\Delta \eta \gets \eta(node, bod)$ dle vzorce \eqref{formula:el-intenzita} \label{alg:step-step-intenzita}	\State zvıšení intenzity vazby $node$ - pamìová stopa pøedmìtu\footnote{Nejedná se o stopu vjemu ale o pamìovou stopu pøedmìtu definovanou v kapiotle \ref{chapter-pamet-predmety}} o $\Delta \eta$\EndFor\State $\eta(stopa) \gets \eta(stopa) \times fade_{\eta}$\If{$\eta(stopa) < \eta_{forget}$}	\State zmizení stopy vjemu\EndIf\end{algorithmic}\end{algorithm}Na øádku \ref{alg:step-step-gravitace} je pouita zmìna polohy uzlu $\Delta_{xy}$, je dána vzorcem:\begin{equation} \Delta_{xy}(node, stopa) = \frac{\eta(stopa)}{\eta_0} \times \frac{ sila_{pritazlivost} }{ dist(node, stopa)^2 \times \mu(node) }\label{formula:el-ep-gravitace}\end{equation}\\Na øádku \ref{alg:step-step-intenzita} je zvıšena intenzita vazby mezi uzlem a pamìovou stopu.Zvıšení je dáno podobnım vzorcem jako \eqref{formula:intenzita-vazby} s jedinım rozdílem, e místo vjemu se pracuje s jeho stopou:\begin{equation} \Delta \eta(node, stopa) = \eta(stopa) \times \frac{ norm( dist(node, stopa) ) }{\sum_{n \in nodes_{around}}  norm( dist(n, stopa) )}\label{formula:el-intenzita}\end{equation}\\kde $nodes_{around}$ je mnoina všech uzlù v okolí stopy vjemu.Funkce $norm$ je libovolná klesající funkce mající obor hodnot $<0,1>$, napø. nepøímá úmìra $norm(x) = 1/max(1,x)$ èi Gaussova funkce.\\Na konci algoritmu jsou pouity dva parametry modelu: \param{limit zmizení} $\eta_{forget}$ a \param{míra slabnutí} $fade_{\eta}$.\\% ODPUDIVOST UZLU %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\subsection{Odpudivost uzlù}V kadém kroku simulace se uzly, které jsou pøíliš blízko u sebe, odpuzují.\begin{definition}[Dosah odpudivosti]Parametr modelu dosah odpudivosti urèuje, na jakou vzdálenost se uzly mapy ještì odpuzují. Vzdálenìjší uzly se neodpuzují.(ELAntigravityRange)\end{definition}\begin{definition}[Síla odpudivosti]Parametr modelu \param{síla odudivosti} urèuje, jak moc se uzly mapy odpuzují. Pùsobí jako opak síly pøitalivosti.(ELAntigravityRange)\end{definition}\begin{definition}[Vliv naplnìnosti]Parametr modelu \param{vliv naplnìnosti} urèuje, jak velkı vliv má naplnìnost uzlu na jeho odpudivost s ostatními uzly.(ELAGUsageCoef)\end{definition}\begin{definition}[Limit pohybu uzlu]Parametr modelu \param{limit pohybu} urèuje maximální monou zmìnu polohy uzlu v jednom kroku simulace.(MaxELNodeMove)\end{definition}Zmìna polohy uzlu kvùli odpudivosti je souèet odpudivıch sil okolních uzlù a je nepøímo úmìrná naplnìnosti uzlu.Nejdøíve jsou urèeny okolní uzly jako mnoina:\begin{equation} nodes_{around} = \{ n \in nodes ; dist(n, stopa) < dosah_{odpudivost} \}\label{formula:el-okolni-uzly-ag}\end{equation}Pro všechny okolní uzly je spoètena vzájemná odpudivost dle vzorce:\begin{equation} odpudivost(n_i, n_j) = \frac{ sila_{odpudivost} }{ dist'(n_i, n_j)^2 \times \mu'(n_i) \times \mu'(n_j) } \label{formula:el-odpudivost}\end{equation}kde\begin{equation} dist'(a,b) = max(1,dist(a,b))\end{equation}a\begin{equation} \mu'(node) = max(\mu_{vliv},\mu'(node))\end{equation} Funkce $max$ jsou pouity, aby zabránili dìlení nulou a sníili vliv velmi malé vzdálenosti mezi dvìma uzly a velmi malé naplnìnosti na odpudivost uzlù.Vısledky s rùznımi hodnotami \param{vlivu naplnìnosti} jsou v kapitole \ref{chapter-test-ag}.\\Po urèení všech odpudivıch sil, které na uzly pùsobí, jsou polohy uzlù upraveny dle tìchto sil a jejich aktuální naplnìnosti:\begin{equation} \Delta_{xy}(node) = \frac{\sum_{\substack{   n \in nodes  }}  odpudivost(n, node)}{ max(1, \mu(node)) } \label{formula:el-odpudivost}\end{equation}\\Funkce $max$ je ve vzorci opìt pouita, aby zabránila dìlení nulou a pøíliš velkım zmìnám polohy uzlù pro $\mu(node) \to 0$.Pøesto je moné, e se v jednom kroku simulace nasèítají takové odpudivé a pøitalivé síly, e by zmìna polohy uzlu mohla pøesáhnout rozumnou mez.Nechceme, aby kvùli krátkodobım stavùm sítì \footnote{napø. pøi vytvoøení nového uzlu prostorové mapy} uzly pøíliš mìnily svou polohu.\\Pøidali jsme tedy omezení na maximální monı pohyb uzlu - parametr modelu \param{limit pohybu}.Pokud by se poloha uzlu mìla zmìnit v jednom kroku simulace o více ne tento limit, zmìní se pouze o tento limit.Alternativní øešení by bylo zmenšit parametr \param{síla odpudivosti} a \param{síla pøitalivosti} a provést více krokù simulace.To je však velmi nároèné na vıkon a vıše uvedené øešení toto vlastnì imituje.\\\subsection{Omezení pohybu uzlù}Následkem odpudivosti uzlù je moné, e se model bude snait pøesunout uzel mimo svìt, resp. vnì polygonu svìt reprezentující.V tom pøípadì je uzel na okraj svìta, tj. na hranu polygonu v místì jejího prùseèíku s úseèkou pøedstavující plánovanou trajektorií uzlu.Pokud se v dalších krocích simulace bude model opìt snait pøesunout uzel vnì polygonu, bude jeho trajektorie promítnuta na hranu polygonu, na které uzel leí.Uzel tak bude "klouzat" po hranì polygonu, jak je ukázáno na obrázku \ref{fig:slide-on-edge}.\\\begin{figure}[h]  \centering  \scalebox{0.8}{\includegraphics{img/slide-on-edge.ps}}  \caption{Zmìna posunu uzlu, kdy narazí na hranu polygonu}  \label{fig:slide-on-edge}\end{figure}% ZMENA POCTU UZLU %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\subsection{Vytváøení uzlù}Je ádoucí, aby se poèet uzlù prostorové mapy v prùbìhu simulace mìnil, dle poètu pøedmìtù, které agent vidìl resp. dle èetnosti a intenzity vjemù.Mapa tedy vytváøí nové uzly a zapomíná existující uzly. Nové uzly vytváøí stopy vjemu na základì jejich intenzity.Zapomínání uzlù se dìje v kadém kroku simulace resp. v kadém kroku simulace je urèitá pravdìpodobnost, e dojde k zapomenutí uzlu.\\\begin{definition}[Cena vytvoøení uzlu]Vytvoøení nového uzlu stojí urèité mnoství intenzity stopy vjemu. Toto mnoství budeme nazıvat cena vytvoøení uzlu a dále jej budeme znaèit $cost_{create}$.\end{definition}\begin{definition}[Odchylka vytvoøení uzlu]Parametr modelu \param{odchylka vytvoøení uzlu} urèuje, jak daleko od stopy vjemu mùe bıt novı uzel vytvoøen.Pokud bude roven nule, budou všechny uzly vytváøeny pøesnì v poloze stopy vjemu. To by vedlo k døíve uvedenım problémùm s vysokou odpudivostí.(ELNodeAddNoise)\end{definition}\begin{definition}[Poèáteèní naplnìnost uzlu]Parametr modelu, urèující poèáteèní naplnìnost uzlu.(MemObjIntenseToNewNode)\end{definition}Rozšíøili jsme jeden krok simulace pro stopu vjemu - algoritmus \ref{alg:stopa-step} - o vytváøení novıch uzlù, algoritmus \ref{alg:stopa-step-create}.\begin{algorithm}[h!]\caption{Vytváøení uzlù v rámci stopy vjemu}\label{alg:stopa-step-create}\begin{algorithmic}[1]\State $p_{create} \gets$ pravdìpodobnost vzniku nového uzlu daná vzorcem \eqref{formula:el-pst-node-create} \label{alg:ep-step-create}\State $r \gets$ náhodné èíslo $r \in <0,1>$\If{$r < p_{create}$}  \State vytvoøení nového uzlu  \State vytvoøení vazby uzlu na pamìovou stopu pøedmìtu  \State $\eta(stopa) \gets \eta(stopa) - cost_{create}$ \label{alg:ep-step-cost}\EndIf\end{algorithmic}\end{algorithm}Na øádku \ref{alg:ep-step-create} je pouita pravdìpodobnost vytvoøení nového uzlu, ta je dána vzorcem:\begin{equation} p_{create}(\eta(stopa), cost_{create}) = \frac{\eta(stopa) - cost_{create}}{cost_{create}}\label{formula:el-pst-node-create}\end{equation}\\Novì vytvoøenı uzel bude mít stejnou polohu jako stopa vjemu s náhodnou odchylkou \(\in <-\Delta,\Delta>\), kde $\Delta$ je \param{odchylka vytvoøení uzlu}.Jeho naplnìnost bude \param{poèáteèní naplnìnost uzlu}.Bude vytvoøena vazba mezi uzlem a pamìovou stopou pøedmìtu, která je souèástí stopu vjemu, která uzel vytvoøila.\\\subsection{Zapomínání uzlù}\begin{definition}[Cena zapomenutí uzlu]Zapomenutí uzlu stojí urèité mnoství energii na zapomínání. Toto mnoství budeme nazıvat cena zapomenutí uzlu a dále jej budeme znaèit $cost_{forget}$.\end{definition}\begin{definition}[Míra zapomínání uzlù]Parametr modelu \param{míra zapomínání uzlù} urèuje jak rychle bude prostorová mapa zapomínat uzly.(ELForgetNodeRate)\end{definition}K zapomenutí mùe dojít kadı kroku simulace. Vrstva uzlù akumuluje tzv. energii na zapomínání $e_{forget}$.Na zaèátku je rovná nule a v prùbìhu simulace roste.V kadém kroku je zvıšena o hodnotu parametru \param{míra zapomínání uzlù}.Dále je urèena pravdìpodobnost, e bude zapomenut uzel $p_{forget}$:\begin{equation} p_{forget} = \frac{e_{forget} - cost_{delete}}{cost_{forget}}\label{formula:el-pst-forget}\end{equation}Pokud má dojít k zapomenutí uzlu, je vybrán náhodnı uzel a ten je odstranìn z prostorové mapy vèetnì všech jeho vazeb na pamìové stopy.Proces zapomínání uzlu je popsán algoritmem \ref{alg:node-forget}.\begin{algorithm}[h!]\caption{Zapomínání uzlù}\label{alg:node-forget}\begin{algorithmic}[1]\State $e_{forget} \gets e_{forget} + rate_{forget}$\State $p_{forget} \gets$ pravdìpodobnost zapomenutí uzlu daná vzorcem \eqref{formula:el-pst-forget} \label{alg:el-forget}\State $r \gets$ náhodné èíslo $r \in <0,1>$\If{$r < p_{forget}$}  \State $node \gets $ náhodnì vybranı uzel  \State $e_{forget} \gets e_{forget} - cost_{forget}$ \label{alg:el-forget-cost}  \State zapomenutí uzlu  \State lokální simulace odpudivosti v okolí smazaného uzlu\EndIf\end{algorithmic}\end{algorithm}Kdy je z mapy odstranìn uzel, mùe dojít a typicky dochází k narušení nauèeného rovnomìrného rozloení uzlù v prostoru, smazanı uzel za sebou nechává prázdné místo.Èást prostorové mapy kolem smazaného uzlu by bylo vhodné pøeuèit, pøemístit uzly, aby byly opìt rovnomìrnì rozdìlené.Proto je pøi smazání uzlu provedeno nìkolik lokálních krokù simulace, kdy je provádìno pouze odpuzování uzlù v okolí smazaného uzlu.Tento proces má dva parametry: \param{poèet opakování} a \param{velikost okolí}.\begin{definition}[Poèet opakování]Parametr modelu \param{poèet opakování} urèuje poèet opakování lokálních krokù simulace.(ELDeleteNodeReTrainCount)\end{definition}\begin{definition}[Velikost okolí]Parametr modelu \param{velikost okolí} urèuje velikost okolí, tj. uzly, jejich poloha se mìní.(ELDeleteNodeReTrainRange)\end{definition}% CENA UZLU %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\subsection{Cena vytvoøení a zapomenutí uzlu}Chtìli bychom, aby poèet uzlù mapy se po urèité dobì ustálil a aby tento poèet reflektoval èetnost vjemù.V okamiku, kdy agent místnost opustí, mìl by poèet uzlù mapy postupnì klesat.Prostorová mapa nebude dostávat ádné vjemy a tedy ani vytváøet nové uzly, bude je pouze zapomínat.Klesání poèetu uzlù by mìlo bıt pozvolné a zpomalovat. Poèet uzlù by nemìl klesnout na nulu.Vıše uvedenou cenu vytvoøení a zapomenutí uzlu mùeme urèit mnoha zpùsoby.Mùe bıt konstantní èi mùe rùznımi zpùsby záviset na aktuálním poètu uzlù.V této kapitole uvedeme rùzné monosti, ukáeme vısledky testù a vybereme nejlepší øešení.\\\subsubsection{Konstantní cena}Nejjednodušší moností je urèit cenu jako konstantu. V prùbìhu simulace se nebude mìnit.Nemùe záviset na èasu, protoe poèet pøedmìtù ve svìtì se mùe mìnit zcela náhodnì, tedy ubıvat i pøibıvat.Nemùeme tedy øíci, e cena roste s dobou, kterou agent v místnosti strávil.\begin{figure}[h!]  \centering  \subfloat[EmptyRoom]{\label{fig:nc-100-empty}\includegraphics[width=0.5\textwidth]{img/nc/100-empty.eps}}  \subfloat[FullRoom]{\label{fig:nc-100-full}\includegraphics[width=0.5\textwidth]{img/nc/100-full.eps}}  \caption{Test konstantní ceny}  \label{fig:nc-fixed}\end{figure}Vısledek testu konstantní ceny je na obrázku \ref{fig:nc-fixed}. Graf zobrazuje poèet uzlù prostorové mapy v èase.Na konkrétní hodnotì nezáleí, testy s jinımi hodnotami ceny mají obdobné vısledky obdobné\footnote{Jsou na pøiloeném CD}.Pokud je cena konstantní, v místnost s vìtším poètem pøedmìtù uzlù neustále pøibıvá.V místnosti s malım poètem pøedmìtù uzly mizí a jejich poèet klesá a k nule.Je tedy zøejmé, e cena nemùe bıt konstatní.\\\subsubsection{Polynomiální závislot na poètu uzlù}\begin{definition}[Chtìnı poèet uzlù]Ze vzorce \eqref{formula:el-start-pocet-uzlu} je urèen poèáteèní poèet uzlù.Chtìnı poèet uzlù $n_{desired}$ je poèet uzlù, které by v prostoru mìly bıt, urèenı jen dle jeho velikosti.Je to konstanta, dvojnásobek poètu uzlù, které jsou do prostoru umístìny na zaèátku.\end{definition}Definujme cenu vytvoøení uzlu $cost_{create}$ resp. zapomenutí uzlu $cost_{forget}$ jako funkci $n_{desired}$ a aktuálního poètu uzlù $n_{c}$.Pro jednoduchost budou tyto funkce symetrické dle osy y, $cost_{create}$ bude rostoucí a $cost_{forget}$ klesající.Tím zabráníme pøílis velkım a rychlım zmìnám poètu uzlù. Definujme funkce takto:\\\begin{equation} cost_{create}(n_{desired}, n_{c}) = \eta_0 \times \frac{n_{desired}}{n_{c}}\label{formula:cost-create-linear}\end{equation}\begin{equation} cost_{forget}(n_{desired}, n_{c}) = \eta_0 \times \frac{n_{c}}{n_{desired}}\label{formula:cost-forget-linear}\end{equation}kde $\eta_0$ je parametr modelu \param{vliv vjemu}.Vısledky testù jsou na obrázku \ref{fig:nc-linear-long}. Ukazují, e takto definovaná ceny by fungovala pro dobu, kdy se agent pohybuje ve svìtì.V kroku 5000 opustil místnost a poèet uzlù bìhem 10000 resp. 15000 krokù klesl témìø na nulu.\\\begin{figure}[h!]  \centering  \subfloat[EmptyRoom]{\label{fig:nc-100-empty}\includegraphics[width=0.5\textwidth]{img/nc/linear-empty-long.eps}}  \subfloat[FullRoom]{\label{fig:nc-100-full}\includegraphics[width=0.5\textwidth]{img/nc/linear-full-long.eps}}  \caption{Test lineární ceny, agent opustil místnost v kroku 5000.}  \label{fig:nc-linear-long}\end{figure}Je tøeba zabránít klesnutí poètu uzlù na nulu. Pokud zmìníme chtìnı poèet uzlù $n_{desired}$, situaci nevyøešíme.Definujme funkce jako kvadratické takto:\begin{equation} cost_{create}(n_{desired}, n_{c}) = \eta_0 \times (\frac{n_{desired}}{n_{c}})^2\label{formula:cost-create-square}\end{equation}\begin{equation} cost_{forget}(n_{desired}, n_{c}) = \eta_0 \times (\frac{n_{c}}{n_{desired}})^2\label{formula:cost-forget-square}\end{equation}\\Vısledky testù jsou na obrázku \ref{fig:cost-square-long}.Klesání uzlu vlivem zapomínání v dobì, kdy agent opustil místnost, splòuje poadavky,alespoò pokud tato doba je pouze nìkolikanásobek doby, kterou agent v místnosti strávil.V dobì, kdy agent byl v místnoti, poèet uzlù rostl, pøestoe zobrazenı test byl proveden v místnosti obsahující pouze jedne pøedmìt.To je zpùsobeno tím, e cena definovaná vzorcem \eqref{formula:cost-create-square} resp. \eqref{formula:cost-forget-square} pøíliš mìní poèet uzlù tak,aby byl co nejvíce roven chtìnému poètu uzlù $n_{desired}$. Zvyšováním stupnì polynomu to jen urychlí.\\\begin{figure}[h!]  \centering  \includegraphics[width=1.0\textwidth]{img/nc/square-empty-long.eps}  \caption{Test kvadratické ceny v místnosti EmptyRoom, agent opustil místnost v kroku 5000.}  \label{fig:cost-square-long}\end{figure}\subsubsection{Exponenciální závislost na poètu uzlù}Definujme funkce takto:\begin{equation} cost_{create}(n_{desired}, n_{c}) = coef_1 \times 3^{\displaystyle coef_2 \times \frac{ n_{c} - n_{desired} }{ n_{desired} } }\label{formula:cost-create-exp}\end{equation}\begin{equation} cost_{forget}(n_{desired}, n_{c}) = coef_1 \times 3^{\displaystyle - coef_2 \times \frac{ n_{c} - n_{desired} }{ n_{desired} } }\label{formula:cost-forget-exp}\end{equation}\\Hodnotu koeficient $coef_1$ jsme urèili pevnì, je rovna hodnotì parametr \param{vliv vjemu} $\eta_0$.Provedli jsme testy rùznıch hodnot koeficientu $coef_2$, vısledky jsou na obrázcích \ref{fig:nc-exp-20}, \ref{fig:nc-exp-50}, \ref{fig:nc-exp-100} a \ref{fig:nc-exp-200}.Vyplıvá z ních, e $coef_2$ urèuje míru, s jakou se poèet uzlù bude blíit chtìnému poètu uzlù $n_{desired}$.Po dosaení rovnováného poètu uzlù, urèuje $coef_2$ velikost odchylky, jak moc bude poèet uzlù fluktuovat.Èím je $coef_2$ vyšší, tím rychleji se poèe uzlù blíí $n_{desired}$ a tím menší je odchylka.Nejlepší se jeví hodnota $coef_2 = 1$.\\\begin{figure}[p]  \centering  \subfloat[EmptyRoom]{\label{fig:nc-exp-20-empty}\includegraphics[width=0.5\textwidth]{img/nc/exp-20-empty.eps}}  \subfloat[FullRoom]{\label{fig:nc-exp-20-full}\includegraphics[width=0.5\textwidth]{img/nc/exp-20-full.eps}}  \caption{Test exponenciální ceny pro $coef_2 = \frac{2}{5}$.}  \label{fig:nc-exp-20}\end{figure}\begin{figure}[p]  \centering  \subfloat[EmptyRoom]{\label{fig:nc-exp-50-empty}\includegraphics[width=0.5\textwidth]{img/nc/exp-50-empty.eps}}  \subfloat[FullRoom]{\label{fig:nc-exp-50-full}\includegraphics[width=0.5\textwidth]{img/nc/exp-50-full.eps}}  \caption{Test exponenciální ceny pro $coef_2 = 1$.}  \label{fig:nc-exp-50}\end{figure}\begin{figure}[p]  \centering  \subfloat[EmptyRoom]{\label{fig:nc-exp-100-empty}\includegraphics[width=0.5\textwidth]{img/nc/exp-100-empty.eps}}  \subfloat[FullRoom]{\label{fig:nc-exp-100-full}\includegraphics[width=0.5\textwidth]{img/nc/exp-100-full.eps}}  \caption{Test exponenciální ceny pro $coef_2 = 2$.}  \label{fig:nc-exp-100}\end{figure}\begin{figure}[p]  \centering  \subfloat[EmptyRoom]{\label{fig:nc-exp-200-empty}\includegraphics[width=0.5\textwidth]{img/nc/exp-200-empty.eps}}  \subfloat[FullRoom]{\label{fig:nc-exp-200-full}\includegraphics[width=0.5\textwidth]{img/nc/exp-200-full.eps}}  \caption{Test exponenciální ceny pro $coef_2 = 4$.}  \label{fig:nc-exp-200}\end{figure}Provedli jsme ještì test zapomínání, tedy s dlouho dobou, kdy je agent mimo místnost. Jeho vısledky jsou na obrázku \ref{fig:nc-exp-50-long}.Ukazují, e takto definované ceny si se zapomínáním nedokáí vùbec poradit, poèet uzlù klesá pøíliš rychle a brzy dosáhne hodnoty nula.\\\begin{figure}[h!]  \centering  \subfloat[EmptyRoom]{\label{fig:nc-exp-50-empty-long}\includegraphics[width=0.5\textwidth]{img/nc/exp-50-empty-long.eps}}  \subfloat[FullRoom]{\label{fig:nc-exp-50-full-long}\includegraphics[width=0.5\textwidth]{img/nc/exp-50-full-long.eps}}  \caption{Test exponenciální ceny pro $coef_2 = 1$ vèetnì zapomínání, agent opustil místnost v kroce 5000.}  \label{fig:nc-exp-50-long}\end{figure}Jako øešení jsme zvolili souèet dvou exponenciálních funkcí \eqref{formula:cost-create-exp} s rùznımi hodnotami $coef_1$ a $coef_2$.Oznaème zobecnìní funkce \eqref{formula:cost-create-exp} takto:\begin{equation} cost^{coef_1}_{coef_2}(n_{desired}, n_{c}) = coef_1 \times 3^{\displaystyle coef_2 \times \frac{ n_{c} - n_{desired} }{ n_{desired} } }\label{formula:cost-coefs}\end{equation}\\Pak definujme cenu vytvoøení a zapomenutí uzlu takto:\begin{equation} cost_{create}(n_{desired}, n_{c}) = cost^{\eta_0}_{1}(n_{desired}, n_{c}) + cost^{\frac{1}{10000}}_{22}(n_{desired}, n_{c})\label{formula:cost-create-sum}\end{equation}\begin{equation} cost_{forget}(n_{desired}, n_{c}) = cost^{\eta_0}_{1}(n_{desired}, n_{c}) + cost^{\frac{1}{10000}}_{-22}(n_{desired}, n_{c})\label{formula:cost-forget-sum}\end{equation}\\Vısledky testu pro takto definovanou cenu jsou na obrázku \ref{fig:nc-expsum-50}.\\\begin{figure}[h!]  \centering  \subfloat[EmptyRoom]{\label{fig:nc-expsum-50-empty-long}\includegraphics[width=0.5\textwidth]{img/nc/expsum-50-empty.eps}}  \subfloat[FullRoom]{\label{fig:nc-expsum-50-full-long}\includegraphics[width=0.5\textwidth]{img/nc/expsum-50-full.eps}}  \caption{Test ceny jako souètu exponenciel, agent opustil místnost v kroce 5000.}  \label{fig:nc-expsum-50}\end{figure}?? ToDo: OBR grafy scitanych exponenciel ??\\% HIEARCHIE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\subsection{Hiearchie}Jedním z poadavkù na model vrstvy uzlù je, aby umìl vytváøet hiearchii uzlù. Model musí bıt schopen rozpoznat místa s vyšší hustotou uzlù.\\Mnoství odpudivosti v uzlu je sledováno a kdy pøekroèí limit danı modelem, parametr HLAGNeeded, algoritmus \ref{alg:hl-create} vytvoøí novı uzel vyšší úrovnì.?? ToDo? ??\\% MISTA - PLACES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\subsection{Vytváøení míst} \label{chapter-place-detect}\begin{definition}[Mnoství odpudivosti]Uzlùm prostorové mapy pøidáme další vlastnost \emph{mnoství odpudivosti}, které vyjadøuje hustotu uzlù v jeho okolí.Budeme jej znaèit $\varrho(node)$.Nejedná se pouze o aktuální stav, tato vlastnost má urèitou pamì, odráí stav v psledních nìkolika desítkách a stovkách krokù simulace.Jak pøesnì se bude mnoství odpudivosti uzlu mìnit, závisí na dvou parametrch modelu:\param{rychlost rùstu} a \param{rychlost klesání}.\end{definition}\begin{definition}[Rychlost rùstu]Parametr modelu \param{rychlost rùstu $\varrho(node)$} urèuje, jak rychle bude rùst mnoství odpudivosti.Budeme jej znaèit $\Delta^{+}_{\varrho}$.(ELAGAddCoef)\end{definition}\begin{definition}[Rychlost klesání]Parametr modelu \param{rychlost klesání $\varrho(node)$} urèuje, jak rychle bude klesat mnoství odpudivosti.Budeme jej znaèit $\Delta^{-}_{\varrho}$.(ELAGFadeOut)\end{definition}Pøi vytvoøení uzlu je mnoství odpudivosti rovno nule. V kadém kroku, pøi poèítání odpudivıch sil pùsobících na uzel, je zvıšeno o:\begin{equation} \Delta_{\varrho}(node) = \sum_{ 	\substack{		n \in nodes	}}  |odpudivost(n, node)| \times \Delta^{+}_{\varrho}\label{formula:el-agamount}\end{equation}\\kde $nodes$ je mnoina okolních uzlù získána dle \eqref{formula:el-okolni-uzly-ag}.Mnoství odpudivosti uzlu v kroku $i+1$ je dáno vzorcem:\begin{equation} \varrho_{i+1}(node) = \varrho_{i}(node) + \Delta_{\varrho}(node) - \Delta^{-}_{\varrho}\label{formula:el-agamount-delta}\end{equation}\\V prùbìhu simulace se mìní hustota uzlù v rùznıch èástech svìta.Chtìli bychom, aby agent rozpoznal èásti svìta, kde je hustota uzlù\footnote{Vyšší hustota uzlù je zpùsobena pøítomností více pøedmìtù} vìtší a vytvoøil si tak pøedstavu konkrétních míst ve svìtì.\\\begin{definition}[Místo]Místo je kruh danı polohou støedu a polomìrem. Model vytváøí hiearchii míst, místa postupnì dìlí na menší, take místo obsahuje další \emph{podmísta},náleení podmísta do místa budeme znaèit $podmisto \in misto$.\end{definition}\begin{definition}[Úrovìò místa]Místo má svou úrovìò, která urèuje, jak je hluboko v hiearchii míst resp. podmíst. Úroveò místa je o jedna vetší, ne úroveò nadøazeného místa.\end{definition}Na zaèátku simulace je vytvoøeno jedno místo, které pokrıvá celı svìt.Všechny uzly prvotní mapy náleí tomuto prvnímu místu. Jeho poloha a polomìr se nemìní. V prùbìhu simulace je toto místo dìlìno na podmísta a uzly budou náleet do více míst.Uzel náleí místu pokud do nìj geometricky patøí:\begin{equation} node \in misto \iff dist(node,misto) < polomer(misto)\label{formula:el-node-in-misto-geo}\end{equation}\begin{definition}[Mnoství odpudivosti místa]Místo má své mnoství odpudivosti $\varrho(misto)$ rovné souètu mnoství odpudivosti jeho uzlù:\begin{equation} \varrho(misto) = \sum_{n \in misto} \varrho(node,misto)\label{formula:el-agamount-mista-geo}\end{equation}kde funkce $\varrho(node,misto)$ urèuje, jakou èást mnoství odpudivosti uzlu $\varrho(node)$ pøísluší danému místu.Pokud by kadé místo dostalo všechno $\varrho(node)$, došlo by k neustálému vytváøení dalších podmíst.\end{definition}\begin{definition}[Intenzita místa]Místo má svou intenzitu, jedná se o analogii k intenzitì stopy vjemu resp. k naplnìnosti uzlu. Intenzita místa má vliv na zmìnu jeho polomìru a polohy místa.Lze ji chápat jako $\varrho(misto)$ s pamìtí.\end{definition}\begin{definition}[Rychlost rùstu intenzity]Parametr modelu \param{rychlost rùstu intenzity} $\Delta^{+}_{\eta}$ urèuje, jak rychle poroste intenzita místa v závislosti na jeho aktuální intenzitì.\end{definition}\begin{definition}[Limit vzniku podmísta]Parametr modelu \param{limit vzniku podmísta} urèuje mnoství odpudivosti místa nutné pro vytvoøení dalšího podmísta.(PlacesAGNeeded)\end{definition}\begin{definition}[Limit zapomenutí místa]Parametr modelu \param{limit zapomenutí místa} urèuje, kdy bude místo zapomenuto. Pokud bude intenzita místa menší ne tento limit, agent místo zapomene.(PlacesAGMin)\end{definition}\begin{definition}[Rychlost klesání intenzity]Parametr modelu \param{rychlost klesání intenzity} místa urèuje, jak rychle bude agent místa zapomínat.(PlaceAGFadeOut)\end{definition}\begin{definition}[Pohyblivost míst]Parametr modelu \param{pohyblivost míst} urèuje rychlost pohybu míst, jak moc se bude mìnit jejich poloha.(PlaceMoveCoef)\end{definition}\begin{algorithm}[h!]\caption{Jeden krok simulace místa}\label{alg:el-step-misto}\begin{algorithmic}[1]\State $\varrho(misto) \gets $ mnoství odpudivosti dle vzorce \eqref{formula:el-agamount-mista-geo} \label{alg:el-step-misto-varrho}\State $\eta(misto) \gets \eta(misto) + \Delta_{\eta(misto)}$ dle vzorce \eqref{formula:el-mist-delta-eta} \label{alg:el-step-misto-eta}\If{$\eta(misto) < \eta_{forget} \times (uroven(misto)-1)$}  \State zapomenutí místa\EndIf\If{$\varrho(misto) > \varrho_{split} \times 2^{uroven(misto)-1} $}  \State vytvoøení podmíst \label{alg:el-step-misto-podmista}\EndIf\State urèení váeného centroidu místa $c_w$ \label{alg:el-step-misto-centroid}\State urèení nové polohy místa \label{alg:el-step-misto-misto}\State urèení polomìru místa dle jeho $\eta(misto)$ dle vzorce \eqref{formula:el-misto-range} \label{alg:el-step-misto-polomer}\end{algorithmic}\end{algorithm}Kadı krok simulace je pro kadé místo proveden proces popsanı v algoritmu \ref{alg:el-step-misto}.V algoritmu jsou pouity parametry modelu \param{limit vzniku podmísta} $\varrho_{split}$ a \param{limit zapomenutí místa} $\eta_{forget}$.Na øádku \ref{alg:el-step-misto-eta} je zmìnìna intenzita místa o $\Delta_{\eta(misto)}$, to je urèené vzorcem:\begin{equation} \Delta_{\eta(misto)} = \varrho_{total}(misto) \times \frac{1}{ max(1, \eta(misto) \times \Delta^{+}_{\eta}) } - fade_{\eta}\label{formula:el-mist-delta-eta}\end{equation}kde $\Delta^{+}_{\eta}$ je parametr modelu \param{rychlost rùstu intenzity místa},$fade_{\eta}$ je parametr modelu \param{rychlost klesání intenzity} a $\varrho_{total}(misto)$ je celkové mnoství odpudivosti:\begin{equation} \varrho(misto) = \sum_{n \in misto} \varrho(node) + \sum_{m \in misto} \varrho(m)\label{formula:el-agamount-mista}\end{equation}\\Na øádku \ref{alg:el-step-misto-centroid} je urèen váenı centroid místa:\begin{equation} c_w(misto) = \frac{\displaystyle \sum_{n \in misto} n_{xy} \times \varrho(n) + \sum_{m \in misto} m_{xy} \times \varrho_{total}(m) }{\displaystyle \varrho_{total}(misto)}\label{formula:el-centroid-mista}\end{equation}kde $n$ je uzel a $m$ podmísto.Pak je poloha místa je poté posunuta smìrem k centroidu o $\Delta_{xy}$ urèené vzorcem:\begin{equation} \Delta_{xy} = dist(misto,centorid) \times min \left(1,\frac{\eta_0(misto)}{\eta(misto)}\right) \times pohyblivost_{mist}\label{formula:el-agamount-mista}\end{equation}kde $pohyblivost_{mist}$ je parametr modelu \param{pohyblivost míst}.Na øádku \ref{alg:el-step-misto-polomer} je urèen novı polomìr místa dle vzorce:\begin{equation} polomer(misto) = polomer_0(misto) \times \left( \frac{2}{5} \times \frac{\eta_0(misto)}{\eta(misto)} + \frac{3}{5} \right)\label{formula:el-misto-range}\end{equation}kde $\eta_0(misto)$ je poèáteèní intenzita místa a $polomer_0(misto)$ je poèáteèní polomìr místa, tedy jeho polomìr a intenzita, kdy bylo vytvoøeno.Hodnoty $\frac{2}{5}$ a $\frac{3}{5}$ urèují, jak moc se polomìr místa mùe zmìnit.\\Pokud v algoritmu na øádce \label{alg:el-step-misto-podmista} dojde k dìlení místa resp. vytváøení podmíst, je proveden následující proces.\\\begin{algorithm}[h!]\caption{Rozdìlení místa na podmísta}\label{alg:el-misto-split}\begin{algorithmic}[1]\State $node \gets \arg \max_{n \in misto} \varrho(n) $ \State vytvoøení nového podmísta\State $podmisto_{xy} = node_{xy}$\State $polomer(podmisto) = polomer(misto) / 2$\State urèení uzlù podmísta, $podmisto_{nodes} \subseteq misto_{nodes}$\State $\varrho(podmisto) \gets $ mnoství odpudivosti dle vzorce \eqref{formula:el-agamount-mista}\State $\eta(podmisto) \gets \varrho(podmisto)$\State urèení váeného centroidu místa $c_w$\State urèení nové polohy místa \label{alg:el-step-misto-misto}\State urèení polomìru místa dle jeho $\eta(misto)$ dle vzorce \eqref{formula:el-misto-range}\end{algorithmic}\end{algorithm}Nejdøíve je vybrán uzel s nejvìtším mnostvím odpudivosti, s ním je proveden algoritmus \ref{alg:el-misto-split}.Pak je znovu spoèteno mnoství odpudivosti $\varrho(misto)$ místa a pokud nekleslo pod polovinu, je algoritmus \ref{alg:el-misto-split} zopakován.Algoritmus \ref{alg:el-misto-split} je provádìn tak dlouho, ne $\varrho(misto)$ klesne pod polovinu pùvodní hodnoty.Pokud novì vytvoøené podmísto má menší mnoství odpudivosti ne parametr \param{limit zapomenutí místa}, je ihned zrušeno a místo není dále dìleno.\\Po provedení algoritmu \ref{alg:el-step-misto} pro všechna místa prostorové mapy, je aktualizována pøíslušnost uzlù do míst dle \eqref{formula:el-agamount-mista-geo}.\\Otázkou zùstává funkce $\varrho(node,misto)$.Definujme ji takto:\begin{equation} \varrho(node,misto) =  \frac{\varrho(node)}{ \mid \{m \in mista ; node \in m  \}  \mid }\label{formula:el-place-node-share}\end{equation}Vısledek testu vytváøení míst je na obrázku \ref{el-place-node-share}.Ukazuje, e i kdy kadé místo dostane jen èást $\varrho(node)$, místa se pøekrıvají.V prùbìhu simulace jsou sice nová podmísta vytváøena správnì, ale bìhem nìkolika desítek krokù se pøesunou na stejnıstøed \footnote{Toto chování je lépe vidìt na videu, které je na pøiloeném CD.}.\\\begin{figure}[h!]  \centering  \includegraphics[width=0.6\textwidth]{img/places/share-all.eps}  \caption{Vısledek testu vytváøení míst pro \eqref{formula:el-place-node-share} }  \label{fig:el-place-node-share}\end{figure}To je zpùsobeno tím, e pøílíš velkou èást $\varrho(node)$ dostane místo s úrovní jedna.Definujme funkci $\varrho(node,misto)$ tak, aby uzel dávat vìtší èást svého $\varrho(node)$ tìm místùm, která jsou níe v hiearchii, tj. mají vyšší úrovìò,následujícím zpùsobem:\begin{equation} \varrho(node,misto) = \varrho(node) \times  \frac{\displaystyle 2^{uroven(misto)} }{\displaystyle \sum_{\substack{   m \in mista \\   node \in m  }} 2^{uroven(m)}  }\label{formula:el-place-node-share-exp}\end{equation}\begin{figure}[p]  \centering  \includegraphics[width=0.6\textwidth]{img/places/share-exp.eps}  \caption{Vısledek testu vytváøení míst pro \eqref{formula:el-place-node-share-exp} }  \label{fig:el-place-node-share-exp}\end{figure}Vısledek je na obrázku \ref{fig:el-place-node-share-exp}. Ukazuje, e ani exponenciální závislost na úrovni místa nezabrání pøekrıvání míst.Pokud definujme funkci $\varrho(node,misto)$ tak, aby uzel rozdìloval rovnomìrnì své $\varrho(node)$ pouze místùm s nejvyššíúrovní \footnote{Stejnì jako v \eqref{formula:el-place-node-share}, ale mnoina ve jmenovateli bude obsahovat pouze místa s nejvyšší úrovní},dosáhneme stejného vısledku, viz obrázek \ref{fig:el-place-node-share-maxlevel}.\\\begin{figure}[p]  \centering  \includegraphics[width=0.6\textwidth]{img/places/share-maxlevel.eps}  \caption{Vısledek testu vytváøení míst, kdy uzel dává $\varrho(node)$ pouze uzlùm nejvyšší úrovnì.}  \label{fig:el-place-node-share-maxlevel}\end{figure}Toto pøekrıvání míst je zpùsobeno tím, e $\varrho(node)$ je sdíleno více místy.Do modelu lze pøidat odpudivost míst, to by však model vıraznì zesloitilo.Zkusili jsme pøehodnotit náleení uzlu do místa tak, aby kadı uzel náleel vdy právì jednomu místu.Úroveò místa je diskrétní velièina, která vyjadøuje jak malou oblast místo pøedstavuje.Podobnı vıznam má i polomìr místa, je to však spojitá velièina, lze pomocí ní tedy urèit právì jedno místo.Øeknìmì, e uzel náleí místu s nejmenším polomìrem do kterého geometricky patøí:\begin{equation} node \in misto \iff misto = \arg \min_{m \in mista(node)} polomer(m)\label{formula:el-node-in-misto}\end{equation}\begin{equation} mista(node) = \{m \in mista ; dist(node,m) < polomer(m)\}\label{formula:el-node-in-misto2}\end{equation}kde $mista$ je mnoina všech míst prostorové mapy.Pak mùeme definovat mnoství odpudivosti místa jednodušeji ne v \eqref{formula:el-agamount-mista-geo}, pouze jako souèet:\begin{equation} \varrho(misto) = \sum_{n \in misto} \varrho(node)\label{formula:el-agamount-mista}\end{equation}Provedli jsme ještì úpravu urèení polomìru v závislosti na jeho intenzitì.Chceme, aby polomìr místa se pøilis nemìnil a plnil tak roli úrovnì místa v okamiku, kdy urèujeme, které uzly do místa patøí.Zmìnili jsme tedy koeficienty v \ref{formula:el-misto-range} na:\begin{equation} polomer(misto) = polomer_0(misto) \times \left( \frac{1}{5} \times \frac{\eta_0(misto)}{\eta(misto)} + \frac{4}{5} \right)\label{formula:el-misto-range-new}\end{equation}Vısledek testu je na obrázku \ref{fig:el-place-node-share-one}.Na jeho základì\footnote{A na základì dalších testù, které lze nalézt na pøiloeném CD.} povaujeme toto øešení za vyhovující.\begin{figure}[h!]  \centering  \includegraphics[width=0.6\textwidth]{img/places/share-one.eps}  \caption{Vısledek testu vytváøení míst, kdy uzel náleí právì jednomu místu. Dva pøedmìty v levém horním rohu agent v prùbìhu simulace nikdy nepouil a pouze nìkolikrát vidìl.}  \label{fig:el-place-node-share-one}\end{figure}% SHRNUTI - PREHLED %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\subsection{Vıslednı model a sloitost algoritmù}V pøedcházejících kapitolách byl postupnì pøedstaven gravitaèní model vèetnì rùznıch variant a slepıch vıvojovıch vìtví.Tato kapitola shrnuje vıslednı model.Gravitaèní model vrstvy uzlù má tøi hlavní èásti: \emph{vytvoøení prvotní mapy}, \emph{zpracování vjemu} a \emph{aktualizace mapy}.\\Vytvoøení mapy je popsáno v kapitole \ref{chapter-createmap}.Jeho èasová sloitost závisí pouze na velikost místsnoti, pro kterou je vytváøena, je lineární v poètu uzlù, které je tøeba vytvoøit.Zpracování vjemu znamená pouze vytvoøení stopy vjemu èi zvıšení intenzity ji existující stopy vjemu dle vzorce \eqref{formula:el-stopa-start-int}.Samotné vytvoøení stopy vjemu èi zvıšení intenzity má konstantní èasovou sloitost.Nároènìjší je urèit, zda v dané poloze u nìjaká stopa vjemu je.Staèí projít seznam všech existujících stop vjemu a porovnat jejich polohy, tento algoritmus má lineární èasovou sloitost vzhledem k poètu existujících stop vjemu.Jejich poèet je omezen velikostí percepèního pole a krátkou ivotností, typicky existuje souèasnì nejvıše kolem 10 stop vjemu.\\Nejnároènìjší èástí je aktualizce mapy. Skládá se z následujících èástí:\emph{aktualizace stop vjemu}, \emph{aktualizace uzlù mapy}, \emph{aktualizace míst}, \emph{zapomínání uzlù}.\subsubsection{Aktualizace stop vjemu}Jedná se o algoritmy \ref{alg:stopa-step} a \ref{alg:stopa-step-create}, které jsou postupnì provedeny nad všemi existujícími stopami vjemu.\\Algoritmus \ref{alg:stopa-step} obsahuje dva cykly, poèet opakování je roven poètu okolních uzlù $\mid nodes_{around}\mid$.Tìla obou cyklù jsou konstatní operace. V druhém cyklu je sice pouit vzorec \eqref{formula:el-intenzita}, kterı obsahuje sumu pøes všechny okolní uzly,její hodnota se však nemìní a je moné ji pøedpoèítat v lineárním èase.Mnoinu $nodes_{around}$ okolních uzlù lze urèit v èase $O(n_c)$, kde $n_c$ je poèet uzlù mapy.Protoe platí $\mid nodes_{around}\mid < n_c$, je vısledná èasová sloitost algoritmu pro jednu stopu vjemu $O(n_c)$.\\Algoritmus \ref{alg:stopa-step-create} obsahuje pouze operace s konstantní èasovou sloitostí.Pokud je vytvoøen novı uzel, je nutné urèit místo, do kterého náleí. To však lze provést a v rámci aktualizace míst.Cenu uzlu urèuje vzorec \eqref{formula:cost-create-sum}.\\Vısledná sloitost algoritmu, kterı aktualizuje všechny stopy vjemu, je $O(n_c \times s_c)$, kde $s_c$ je poèet stop vjemu.\\\subsubsection{Aktualizace uzlù mapy}V kadém kroku simulace je urèena vzájemná odpudivost uzlù. To znamená spoèítání vzdálenosti mezi všemi uzly.Urèení odpudivost mezi dvìma uzly má konstantní èasovou sloitost.Spoètení všech odpudivıch sil má tedy èasovou sloitost $O(n_c^2)$.\\Spoètené odpudivé síly jsou promítnuty do mnoství odpudivost uzlu dle vzorce \eqref{formula:el-agamount}.\\\subsubsection{Aktualizace míst}V kadém kroku simulace je nad kadım místem proveden algoritmus \ref{alg:el-step-misto}.Pak je pro kadı uzel mapy urèeno, do jakého místa náleí dle vzorce \eqref{formula:el-node-in-misto}.Pro urèení mnoství odpudivosti místa je v kroku \ref{alg:el-step-misto-varrho} pouit vzorec \label{formula:el-agamount-mista},v kroku \label{alg:el-step-misto-polomer} je pouit vzorec \eqref{formula:el-misto-range-new}.Pokud je mnoství odpudivosti místa vìtší ne limit danı modelem, jsou vytvoøena další podmísta algoritmem \ref{alg:el-misto-split}.\\Vìtšina krokù algoritmu \ref{alg:el-step-misto} má konstantní èasovou sloitost,kroky \ref{alg:el-step-misto-varrho} a \ref{alg:el-step-misto-centroid} závisí na poètu uzlù a podmíst, které místo obsahuje.Tyto kroky lze provést najednou pro všechna místa jedním prùchodem do šíøky stromem míst.Pøi tomto prùchodu bude kadı uzel pouit právì jednou.Pokud nedojde k vytvoøení podmíst, má aktualizace všech míst prostorové mapy lineární sloitost $O(m_c \times n_{c})$, kde $m_c$ je poèet míst mapy.Urèení pøíslušnosti uzlu do místa má stejnou èasovou sloitost.\\Algoritmus \ref{alg:el-misto-split} je velmi podobnı jednomu kroku simulace místa.Jeho èasová sloitost je lineární k poètu uzlù v nadøazeném místì, tj. lze ji omezit $O(n_c)$.Algoritmus mùe bıt pøi jednom dìlení místa spuštìn nìkolikrát, maximální poèet spuštìní závisí na podílu parametrù modelu\param{limit vzniku podmísta} a \param{limit zapomenutí místa}.\\\subsubsection{Zapomínání uzlù}Zapomínání uzlù je popsáno algoritmem \ref{alg:node-forget}.Algoritmus má konstantní èasovou sloitost a na provedení lokálních krokù simulace.Ty znamenají poèítání odpudivosti mezi uzly a lze je omezit $O(n_c^2)$.V kadém kroku je zapomenut nejvıše jeden uzel, poèet kroku je parametr modelu, tedy konstanta.\\\subsubsection{Sloitost kroku simulace}V kadém kroku simulace je provedena aktualizace mapy, která má vıše uvedené èásti.Celková sloitost jednoho kroku simulace je $O(n_c^2)$. Pøedpokládáme, e:$s_c \ll n_c$ a $m_c \ll n_c$.%$O(n_c,s_c)$ - stopy%$O(n_c^2)$ - uzly%$O(m_c, n_{c})$ - mista%$O(n_c^2)$ - forget