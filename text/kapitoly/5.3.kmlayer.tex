\section{Model zaloenı na Kohonenovì mapì}

Vìtšina modelù pamìti, zmínìnıch v tøetí kapitole, vyuívá samoorganizaèní Kohonenovy mapy \cite{litKohonen}.
Kohonenova mapa je model neuronové sítì uèící se bez uèitele, vyuívá soutìní strategii uèení.
Neurony jsou v Kohonenovì mapì uspoøádány do topologické struktury, nejèastìji do dvourozmìrné møíky.
Tím je urèeno, jaké neurony spolu sousedí.
Okolím neuronu $N_s(c)$ velikosti $s$ neuronu $c$ pak rozumíme jeho sousedy a další neurony, jejich vzdálenost v topologii je menší ne $s$:

\begin{equation} 
N_s(c) = \{j:d(j,c)\leq s\},
\label{formula:km-okoli}
\end{equation}

kde $d(j,c)$ je vzdálenost v topologické struktuøe.
Neurony Kohonenovy mapy pøi uèení soutìí o to, kterı z nich bude aktivní pøi daném vstupu.
Vítìznım neuronem se stane ten, kterı se nejvíce podobá vstupu. Jeho váha a váhy neuronù v jeho okolí jsou upraveny.
Ostatní neurony jsou neaktivní a neuèí se. Kohonenova mapa a další modely samoorganizaèních map jsou popsány napø. v \cite{litSimaNeruda}.
\\

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.5\textwidth]{img/kml/kml-start-grid.eps}
  \caption{Poèáteèní pokrytí svìta uzly uspoøádanımi do ètvercové møíky.}
  \label{fig:kml-start}
\end{figure}

Kohonenova mapa by mìla splòovat naše poadavky. Umí rozmístit uzly do hustoty odpovídající rozmístìní pøedmìtù v prostoru.
Umí se uèit online, kadı vjem agenta je moné chápat jako prvek trénovací mnoiny dat.
Navrhli jsme tedy model vrstvy uzlù zaloenı na Kohonenovì mapì.
\\

\begin{definition}[Koeficient uèení]
Rychlost uèení Kohonenovy mapy je parametrizovatelná. Navrenı model toho vyuívá, koeficient uèení urèuje tuto rychlost.
\end{definition}


Na zaèátku je prostor pokryt Kohonenovou mapou, uzly jsou uspoøádány do ètvercové møíky, viz obrázek \ref{fig:kml-start}.
Pokadé, kdy je vjem pøedán ke zpracování, provede se trénování Kohonenovy mapy dle algoritmu \ref{alg:km-uceni}.
\\


\begin{algorithm}[h!]
\caption{Zpracování vjemu}
\label{alg:km-uceni}
\begin{algorithmic}[1]
\State $node_{win} \gets$ vyhrávající uzel (nejbliší k poloze vjemu)
%\State $queue \gets \emptyset$
\State $queue \gets \{node_{win}\}$
\While{$queue\not= \emptyset$}
	\State $n \gets first(queue)$
	\State $queue \gets queue  \setminus \{n\}$
	\State zmìna polohy $n$ dle vzorce \ref{formula:km-uceni} \label{alg:km-uceni-vzorec}
	\State $queue \gets$ sousedi $n$ (pokud nebyli ještì trénováni)
\EndWhile
\State vjem je pøedán vrstvì uzlù k dalšímu zpracování
\end{algorithmic}
\end{algorithm}

Vyhrávající uzel $node_{win}$ je urèen dle vzdálenosti mezi uzlem a vjemem:
\begin{equation}
node_{win} =\argmin_{node \in nodes} dist(node,vjem).
\end{equation}

V algoritmu je na øádce \ref{alg:km-uceni-vzorec} zmìnìna poloha uzlu mapy. Uzel je posunut smìrem k poloze vjemu o \(\Delta xy(n, vjem)\) dle vzorce:

\begin{equation} 
\Delta xy(n, vjem) = coef_{neighbour}(n, node) \times coef_{learn} \times dist(n, vjem),
\label{formula:km-uceni}
\end{equation}

kde \(coef_{neighbour}\) je vzdálenost mezi vyhrávajícím uzlem a právì trénovanım uzlem v Kohonenovì mapì
 a \(coef_{learn}\) je koeficient uèení Kohonenovy mapy.
Vzorec \eqref{formula:km-uceni} je analogií uèení Kohonenovy mapy.
\\

Tímto algoritmem by se mìla prostorová mapa v prùbìhu simulace nauèit rozmístìní pøedmìtù ve svìtì a pøizpùsobit se mu.
Uzly mapy se postupnì pøesunou do míst s velkou èetností vjemù a rozmístìní uzlù by se tak mìlo v èase postupnì blíit rozmístìní pøedmìtù.
\\

\begin{figure}[h!]
  \centering
  \subfloat[Po 1000 krocích]{\label{fig:kml-preuceni-1}\includegraphics[width=0.5\textwidth]{img/kml/kml-preuceni-1.eps}}
  \subfloat[Po 4000 krocích]{\label{fig:kml-preuceni-2}\includegraphics[width=0.5\textwidth]{img/kml/kml-preuceni-2.eps}}
  \caption{Test modelu a ukázka jeho pøeuèení}
  \label{fig:kml-preuceni}
\end{figure}

Test modelu (obrázek \ref{fig:kml-preuceni}) ukázal, e k tomu skuteènì dojde, ale více, ne bychom chtìli.
Problém, kterı nastal je, e se sí pro naše potøeby \uv{pøeuèila}
 -- uzly se èasem všechny pøesunuly k pøedmìtùm a prostor bez pøedmìtù zùstal prázdnı, bez uzlù.
Navrhli jsme dvì øešení:
\begin{CompactItemize}
\item Umìlé pøedmìty - pøidání umìlıch pøedmìtù, které se budou snait dret pùvodní rozloení uzlù Kohonenovy mapy
\item Odpudivost uzlù - uzly mapy se budou vzájemnì odpuzovat, aby se nenahromadily všechny v jednom místì
\end{CompactItemize}

Vıše zmínìná øešení jsme vyzkoušeli v jednoduché ètvercové místnosti.
\\

\subsection{Umìlé pøedmìty}
Toto øešení pøidává do svìta další pøedmìty, agent je nevyuívá k plnìní svıch zámìrù, pouze je vnímá a mìní dle nich svou prostorovou mapu.
Umìlé pøedmìty musí mít niší atraktivitu ne reálné pøedmìty, aby nemìly na prostorovou mapu vìtší vliv ne opravdové pøedmìty.
\\

Umìlé pøedmìty jsou do svìta pøidány na zaèátku, pøi vytváøení ètvercové sítì. V kadém místì, kde je uzel sítì, je vytvoøen jeden umìlı pøedmìt.
Agent je bude vnímat stejnì jako ostatní pøedmìty, v prùbìhu simulace budou k sobì pøitahovat uzly sítì stejnì jako reálné pøedmìty.
Tím by mìly udret Kohonenovu mapu roztaenou i v místech, kde reálné pøedmìty nejsou.
\\

\begin{figure}[h!]
  \centering
  \subfloat[Po 500 krocích]{\label{fig:kml-bo-1}\includegraphics[width=0.5\textwidth]{img/kml/bo-0.5-0500.eps}}
  \subfloat[Po 1000 krocích]{\label{fig:kml-bo-2}\includegraphics[width=0.5\textwidth]{img/kml/bo-0.5-1000.eps}}
  \caption{Test modelu s umìlımi pøedmìty}
  \label{fig:kml-baseobjs}
\end{figure}

Vısledek testu je na obrázku \ref{fig:kml-baseobjs}\footnote{Další vısledky testù s rùznou hodnotou atraktivity umìlıch pøedmìtù jsou na pøiloeném DVD.}.
Uzly mapy se v prùbìhu simulace stahují do støedu místnosti.
Mapa se stahuje do støedu místnosti bez ohledu na vliv umìlıch pøedmìtù.
Dùvodem je to, e tìištì všech umìlıch pøedmìtù je ve støedu místnosti.
Tomu bychom mohli zabránit zvıšením atraktivity umìlıch pøedmìtù, které jsou na kraji místnosti.
Jednoduchım protipøíkladem takového øešení je místnost, která bude mít objekty pouze na kraji (na zdech, v rozích).
Pak bychom potøebovali zvıšit atraktivitu umìlıch pøedmìtù uprostøed místnosti resp. obecnì bychom museli zvıšit atraktivitu umìlıch pøedmìtù v místech,
kde nejsou reálné pøedmìty.
Tím jsme pøevedli pùvodní problém hledání oblastí s vyšším poètem pøedmìtù na problém opaènı, tj. na hledání oblastí bez pøedmìtù.
Øešení s pouitím umìlıch pøedmìtù tedy nevyhovuje.
\\

\subsection{Odpudivost uzlù} \label{s:km-odpudivost}
Do modelu jsme pøidali vzájemnou odpudivost uzlù sítì. V kadém kroku simulace se uzly, které jsou pøíliš blízko u sebe, odpuzují.

\begin{definition}[Síla odpudivosti]
Parametr modelu \param{síla odpudivosti} urèuje míru s jakou se budou uzly odpuzovat.
\end{definition}


Vzájemná odpudivost dvou uzlù závisí na \param{síle odpudivosti}, na vzdálenosti uzlù a jejich naplnìnosti.
Uzel s vysokou naplnìností se bude nacházet v místì, kde je hodnì pøedmìtù.
V takovıch místech by hustota uzlù mìla bıt vìtší, a proto je nutné, aby v takovıch místech byla vzájemná odpudivost uzlù menší.
\\

\begin{equation} 
odpudivost(n_i, n_j) = \frac{ sila_{odpudivost} }{ dist(n_i, n_j)^2 \times \mu(n_i) \times \mu(n_j) } 
\label{formula:km-odpudivost}
\end{equation}
\\

Naplnìnost uzlu lze pøi urèování vzájemné odpudivosti chápat jako analogii k hmotnosti tìles, s tím rozdílem,
e odpudivost dvou uzlù je nepøímo úmìrná souèinu jejich naplnìností. Odpudivost je dána vzorcem \eqref{formula:km-odpudivost},
kde $sila_{odpudivost}$ je parametr \param{síla odpudivosti}.
V kadém kroku simulace je spoètena vzájemná odpudivost uzlù. Tím jsou urèeny všechny odpudivé síly, které na uzly pùsobí.
Poloha uzlù je pak upravena dle tìchto sil:
\\

\begin{equation} 
\Delta_{xy}(node) = \frac{
\sum_{\substack{
   n \in nodes
  }}
  odpudivost(n, node)
}{ max(1, \mu(node)) }
\label{formula:el-odpudivost}.
\end{equation}
\\


\begin{figure}[h!]
  \centering
  \subfloat[Celá místnost s naznaèenım vıøezem]{\label{fig:kml-ag-cele}\includegraphics[height=0.36\textwidth]{img/kml/ag-cele.eps}}
  \quad
  \subfloat[Vıøez]{\label{fig:kml-ag-vyrez}\includegraphics[height=0.36\textwidth]{img/kml/ag-vyrez.eps}}
  \caption{Test modelu s odpudivostí uzlù}
  \label{fig:kml-ag}
\end{figure}

Vısledek testu je na obrázku \ref{fig:kml-ag}\footnote{Další vısledky testù s rùznou hodnotou síly odpudivosti jsou na pøiloeném DVD.}.
Ukazuje, e odpudivost skuteènì rozprostøe uzly po celé místnosti.
Objevil se však jinı problém -- odpudivé síly deformují Kohonenovu mapu do stavu, kdy její následující uèení nedává smysl.
Sí se pøekroutí tak, e uzly (na obrázku \ref{fig:kml-ag} èervenì vyznaèené), které jsou ve virtuálním svìtì vedle sebe, jsou v síti daleko od sebe a obrácenì.
\\

Døíve zmínìnı problém pøeuèení skuteènì nastal a dvì rozdílná øešení jej nedokázala uspokojivì vyøešit. Model zaloenı na Kohonenovì mapì jsme tedy zamítli.
\\