\chapter{Model svìta a agenta}

Model prostorové mapy by mìl bıt nezávislı na konkrétní abstrakci svìta a architektuøe agenta.
Potøebovali jsme však nìjaké jednoduché prostøedí pro jeho vıvoj a testování.
Rozhodli jsme se vytvoøit vlastní virtuální svìt a agenta, kterı v nìm ije - pohybuje se v nìm, provádí èinnosti a vnímá své okolí.
Abstrakce svìta a architektura agenta je popsána v této kapitole. 
\\


\section{Abstrakce svìta}

Èas svìta je diskrétní, probíhá v krocích. Kadı krok má urèenou dobu trvání, která záleí na tom, co agent v daném kroku dìlal.
Napø. popojít o pár metrù trvá sekundy, zatímco pøeèíst si kapitolu v kníce mùe trvat i hodiny. Dobu trvání kroku mùe vzít model prostorové mapy v potaz.
Pro pøiblinou pøedstavu je moné øíci, e 1 den agenta trvá v prùmìru 500-1000 krokù simulace.
\\

Virtuální svìt je 2D, obsahuje jednu místnost\footnote{V dalším textu budeme slovem místnost myslet celı svìt, nebude-li øeèeno jinak.}.
Ta je reprezentována jednoduchım polygonem, urèenım mnoinou vrcholù. Pøíklady svìtù je moné najít v pøíloze A, kde jsou zobrazeny všechny testovací svìty.
\begin{definition}[Poloha objektu]
Prostor je spojitı\footnote{Pøi implementaci modelu dojde k diskretizaci prostoru, protoe numerická pøesnost poèítaèù je omezená.},
poloha všech objektù\footnote{Napø. pøedmìty, vrcholy polygonu urèujícího místnost, agent apod.}
ve svìtì je dána dvojicí souøadnic \(<x,y> \in \mathbb{R}^2\). Polohu objektu $a$ budeme dále znaèit $a_{xy}$ resp. $a_x$ a $a_y$.
\end{definition}

\begin{definition}[Vzdálenost]
Vzdálenost ve svìtì je euklidovská, tj. vzdálenost dvou objektù $a$, $b$ ve svìtì je urèena vzorcem:

\begin{equation} 
dist(a,b) = \sqrt{  (a_x-b_x)^2 + (a_y-b_y)^2 }.
\label{formula:vzdalenost}
\end{equation}

Vzdálenost objektù $a$,$b$ budeme dále oznaèovat: $dist(a,b)$.
Je bezrozmìrná, pro úèely vıvoje a testování modelu jsme urèili velikost všech pøedmìtù a agenta jako 1$\times$1.
Svìt, resp. místnost se vdy vejde do ètverce velikosti 100$\times$100.
\end{definition}

\begin{definition}[Waypoint]
Místnost má dané waypointy - místa, která jsou zajímavá z hlediska tvaru místnosti, napø. kouty, místa dobrého rozhledu apod.
Waypoint je urèen svımi souøadnicemi.
Agent má waypointy místnosti k dispozici. Vyuívá je pøi hledání cesty v nekonvexní místnosti èi pøi náhodném hledání pøedmìtù.
U waypointu je uloeno, kdy jej agent naposledy navštívil.
\end{definition}

\begin{definition}[Velikost waypointu]
Agent navštíví waypoint, pokud jeho vzdálenost od waypointu je menší ne velikost waypointu.
\end{definition}

\begin{definition}[Odchylka waypointu]
Kdy agent pøi svém pohybu svìtem má jako cíl waypoint, nemusí jít pøesnì na souøadnice waypointu.
Mùe se odchılit v ose $x$ i $y$ o odchylku waypointu.
\end{definition}

\begin{definition}[Pøedmìt]
V prostoru jsou umístìny pøedmìty.
Pøedmìty jsou reprezentovány pouze jako body, jejich velikost je zanedbána. Agent pouívá pøedmìty ke splnìní svıch cílù. Toto je popsáno v následující kapitole.
\end{definition}

\begin{definition}[Atraktivita pøedmìtu]
Pøedmìty mohou mít urèenou svou statickou atraktivitu, nakolik jsou pro agenta zajímavé bez ohledu na èinnost, kterou agent právì provádí.
Napø. kvìtina s velkım èervenım kvìtem bude mít vìtší atraktivitu ne zelená øasa.
Není-li øeèeno jinak, je atraktivita všech pøedmìtù rovna 1.
\end{definition}



\section{Architektura agenta} \label{chapter-agent}

Architektura agenta je pøevzata z \cite{litPeskova} a lehce upravena. Øízení chování agenta je zjednodušeno, protoe pro vıvoj modelu není tak podstatné.
Naopak jeho pohyb svìtem a vnímání okolí je propracovanìjší.
\\

\begin{definition}[Afordance]
Stejnì jako v \cite{litPeskova} je vnímání svìta agentem postaveno na Gibsonovì teorii afordancí \cite{litGibson}.
Tato percepèní teorie øíká, e iví tvorové vnímají okolní svìt a pøedmìty spíše dle toho, k èemu se dají pouít, ne dle jejich fyzickıch vlastností
(tvar, velikost, barva). To, k èemu se dá pøedmìt pouít, je vyjádøeno prostøednictvím tzv. afordancí, napø. \uv{lze mì nabrousit}, \uv{lze se mnou krájet}.
Nù tedy není vnímán jako \uv{kus kovu zasazenı do døeva, asi 15 centimetrù dlouhı}, ale jako pøedmìt, kterı lze nabrousit a kterım lze krájet.
\end{definition}

Je urèeno, jaké afordance kadı pøedmìt agentovi nabízí. Èinnosti, které agent provádí, potøebují ke svému provedení urèité zdroje, tj. pøedmìty s afordancemi.
Èinnosti mají urèeno, jaké afordance potøebují, aby mohly bıt úspìšnì splnìny. Afordance lze chápat i jako jednoduché propojení mezi pøedmìty a èinnostmi
bez nutnosti pøesnì specifikovat, jaké všechny pøedmìty jsou k èinnosti tøeba a k èemu všemu lze pøedmìt pouít.
Vıhodou tohoto modelu je rozšiøitelnost, do svìta je moné snadno pøidat nové objekty a èinnosti.
\\

V prùbìhu simulace agent ve svìtì provádí èinnosti, kterımi splòuje své zámìry. Zámìr je nìjakı cíl agenta, napø. odpoèinout si.
Je urèeno, jakımi èinnostmi je moné jej splnit, napø. lehnout si, posadit se. Kdy agent plní zámìr, náhodnì vybere jednu z èinností, kterımi jej lze splnit.
Pak se snaí získat zdroje (pøedmìty) nutné k provedení èinnosti - vytvoøí podzámìr \emph{Want(affordance)}. Ten znamená, e agent chce najít pøedmìt s danou afordancí.
Zámìr \emph{Want(affordance)} agent mùe splnit úspìšnım provedením jedné z tøí èinností:


\begin{CompactItemize}
\item nalezením pøedmìtu v okolí
\item vzpomenutím si, kde se takovı pøedmìt nachází, pøesunutí k nìmu a jeho nalezení
\item náhodné hledání
\end{CompactItemize}

\begin{figure}[h]
  \centering
  \scalebox{0.8}{\includegraphics{img/and-or.ps}}
  \caption{Strom chytrıch akcí a jejich subakcí}
  \label{fig:smart-actions}
\end{figure}


Kadá tato èinnost se skládá z nìkolika akcí, které mohou obsahovat další subakce, a není moné ji provést v jednom kroku simulace.
Vıše zmínìné èinnosti jsou tedy implementovány jako tzv. chytré akce, které si pamatují aktuální stav a dle nìj dokáí urèit, jakou subakci má agent vykonat.
Strom akcí a subakcí je na obrázku \ref{fig:smart-actions}.
Napø. pro náhodné hledání pøedmìtu je pouita chytrá akce \emph{SearchRandom}. Ta je schopná urèit, kam se agent má pøesunout pomocí další chytré akce \emph{MoveTo}.
Teprve akce \emph{MoveToPartial} je atomická a lze ji provést v jednom kroku simulace.
\\

\begin{definition}[Maximální krok agenta]
Parametr modelu \param{maximální krok agenta} urèuje maximální vzdálenost, o kterou agent zmìní svoji polohu v jednom kroku simulace.
\end{definition}

%\begin{definition}[MapPickUpDistance]
%\end{definition}

Chytré akce jsou:

\begin{description}
  \item[MoveTo(x,y)] \hfill \\
  pøesun agenta na polohu $<x,y>$. Nejdøíve je nalezena cesta, pokud je svìt konvexní místnost, jedná se o úseèku; pokud svìt není konvexní, jsou pouity waypointy a cesta je lomená èára. Kadá úseèka je pak rovnomìrnì rozdìlena na kratší èásti tak, aby délka její nejdelší èásti byla menší ne \param{maximální krok agenta}. Díky tomu se agent kadé kolo simulace posune jen o malı kus.
  \item[SearchRandom(afordance)] \hfill \\
  náhodné hledání pøedmìtu s danou afordancí. Agent má u kadého waypointu uloen èas, kdy jej naposledy vidìl. Tato akce zajistí, e agent postupnì navštíví všechny waypointy. Zaène tím, kterı má nejstarší èas a k tomu waypointu, kterı navštívil jako poslední. Toto poøadí je urèeno na zaèátku akce. K pøesunu mezi waypointy agent provádí chytrou akci MoveTo.
  \item[LookUpInMemory(afordance)] \hfill \\
  získání pøedmìtu s danou afordancí s vyuitím prostorové mapy. Agent si nejdøíve vybaví pøedmìt s danou afordancí, kterı si pamatuje nejlépe (to urèí prostorová mapa). K tomutu pøedmìtu se pøesune pomocí chytré akce MoveTo. Pak spustí atomickou akci LookForObject, která je jen speciálním pøípadem akce Explore.
  \item[Execute(èinnost)] \hfill \\
  provedení èinnosti. Tato akce je spuštìna pouze tehdy, pokud èinnost, kterou chce agent vykonat, má ji všechny zdroje. Pak agent ovìøí, zda všechny zdroje èinnosti jsou dostupné, tedy e je v jejich bezprostøední blízkosti. Pokud ne, pøesune se k nim pomocí chytré akce MoveTo.
\end{description}


\begin{table}[h!]
\begin{center}
\begin{tabular}{lp{6cm}}\toprule[0.5pt]

Atomická akce & Efekt \\

\midrule[0.2pt]

MoveToPartial(x,y) & pøesun na pozici x,y\\

ExecuteReal(èinnost) & provedení èinnosti\\

Explore & rozhlédnutí se po okolí\\

Remember(afordance) & vybavení si pøedmìtu z prostorové mapy, kterı má danou afordanci\\

LookForObject(pamìovı fantom) & vyhledání pøedmìtu odpovídajícího pamìovému fantomu\\

\bottomrule[0.5pt]
\end{tabular}\\
\end{center}
\centering
\caption{Atomické akce}
\label{tab:atomic-actions}
\end{table}



Souèástí svìta je i mnoina zámìrù a èinností, které agent mùe vykonávat. Závisí toti na pøedmìtech, resp. jejich afordancích, které jsou ve svìtì dostupné.
Pokud by svìt obsahoval mnoho zámìrù, které nelze v daném svìtì splnit,
bude se agent chovat hloupì a data, která bude dostávat prostorová mapa, budou spíše náhodná, ne aby pøipomínala lidské chování.
Agent pak stráví vìtšinu èasu pohybem mezi waypointy, jak je ukázáno na obrázku \ref{fig:waypoint-hell}, a hledáním pøedmìtù s afordancemi, které se ve svìtì nenacházejí.
Bude vìnovat ménì èasu a tedy i pozornosti ostatním pøedmìtùm.
\\

Na zaèátku simulace je vygenerován agentùv scénáø, tj. posloupnost zámìrù, kterou agent stále dokola provádí.
Scénáø záleí pouze na zámìrech definovanıch v rámci svìta, aby bylo moné provádìt testy modelu se stejnım scénáøem.
\\

\begin{figure}[h]
  \centering
  \includegraphics[width=0.4\textwidth]{img/waypoint-hell.eps}
  \caption{Mapa ukazující, jak svìt agent vnímal. Bílá místa nikdy nevidìl, èím tmavší, tím èastìji agent místo vidìl. Agent se pohyboval pøevánì po waypointech, které jsou v rozích a ve støedu.}
  \label{fig:waypoint-hell}
\end{figure}

Pamì agenta je rozdìlena na krátkodobou a dlouhodobou. Dlouhodobá pamì v našem pøípadì obsahuje pouze prostorovou mapu.
Krátkodobá pamìt se skládá ze tøí èástí: procesní èásti, percepèního pole a pamìové èásti.
Procesní èást obsahuje právì splòovanı zámìr, provádìné èinnosti, chytré akce a subakce, vše uspoøádané do stromu.
Percepèní pole obsahuje odrazy zpozorovanıch pøedmìtù z vnìjšího svìta, tzv. fantomy.
Pamìová èást obsahuje pamìové fantomy, odrazy pøedmìtù vybavené z dlouhodobé pamìti.
\\

\begin{definition}[Velikost percepèního pole]
Percepèní pole obsahuje fantomy, tj. pøedmìty, které agent právì vnímá.
Agent mùe v jednom kroku simulace vidìt libovolné mnoství pøedmìtù, ale je schopen jich vnímat jen omezenı poèet.
Vycházíme z kapacitní teorie pozornosti, která øíká, e celková kapacita lidské pozornosti je omezená \cite{litCapacityAtt}.
Poèet fantomù, které mohou bıt souèasnì v percepèním poli, je dán parametrem \param{velikost percepèního pole}.
Tento parametr je pro všechny testy roven magickému èíslu 7 dle experimentálních vısledkù z \cite{lit7plusminus2}.
Zmìna parametru na nisí hodnotu mùe velmi ovlivnit uèení prostorové mapy.
\end{definition}


V kadém kroku simulace agent dostane mnoinu pøedmìtù, které vidí.
Ta je urèena z agentovy pozice a smìru, kterım se dívá, a závisí i na právì provádìné atomické akci.
Protoe zpùsob vnímání okolí je pro model podstatnı, rozhodli jsme se implementovat s lehkou úpravou pokroèilı model z poèítaèové hry Thief \cite{litThief}.
Vıslednı model bere v potaz vzdálenost pøedmìtù od agenta i to, jak moc by se agent musel otoèit, aby se díval pøímo na nì.
\\

\begin{definition}[Zorné pole]
Agent má definována tzv. zorná pole pøedstavovaná kruhovımi vıseèemi. Jejich støed je v místì agenta a jsou orientovány smìrem, kterım se agent dívá.
Zorné pole je urèeno polomìrem, úhlem a váhou, která urèuje míru vnímavosti agenta na pøedmìty v zorném poli.
\end{definition}

\begin{definition}[Viditelnost pøedmìtu]
V kadém kroku má kadı pøedmìt urèenu svou viditelnost vzorcem \eqref{formula:viditelnost}, kde \emph{p} je pøedmìt, \emph{V} je mnoina zornıch polí agenta,
které agent právì má, a \(p \in v\) znamená, e pøedmìt leí v zorném poli.
\end{definition}

\begin{equation} 
viditelnost(p) = 
\sum_{\substack{
   v \in V\\
   p \in v
  }}
  vaha(v)
\label{formula:viditelnost}
\end{equation}
\\

\begin{figure}
  \centering
  \subfloat[Pøi atomické akci Explore]{\label{fig:vcones-explore}\includegraphics{img/vcones-explore.ps}}                
  \subfloat[Pøi ostatních akcích]{\label{fig:vcones-ostatni}\includegraphics{img/vcones-normal.ps}}
  \caption{Zorná pole urèující agentovo vnímání}
  \label{fig:vcones}
\end{figure}

Mnoina zornıch polí urèuje agentùv zpùsob vnímání. Toho jsme vyuili a definovali dvì rùzné mnoiny zornıch polí.
Jednu pro chvíle, kdy se agent rozhlíí (atomická akce Explore) - obrázek \ref{fig:vcones-explore}, a jednu pro zbylé pøípady - obrázek \ref{fig:vcones-ostatni}.
Úhel 360° v prvním pøípadì simuluje to, e pøi rozhlíení se agent postupnì podívá do všech stran.
\\

Pøedmìty, které mají kladnou viditelnost, agent vidí a jsou pøedány k dalšímu zpracování filtru pozornosti.
Poté jsou pøidány do percepèního pole. Pokud se v nìm udrí alespoò jeden krok simulace, jsou pøedány prostorové mapì a jejich fantomy procesní èásti.
\\

\begin{definition}[Aktuální atraktivita pøedmìtu]
Filtr pozornosti upravuje aktuální atraktivitu pøedmìtù. Atraktivita pøedmìtu má dvì sloky, statickou a dynamickou.
Dynamická atraktivita záleí na atomické akci a èinnosti, kterou agent právì provádí.
Dynamická atraktivita nabıvá hodnot z intervalu \(<0,1>\), viz tabulka \ref{tab:act-attr}.
Aktuální atraktivita pøedmìtu je souèin statické a dynamické atraktivity a jejich viditelnosti.
\end{definition}

\begin{table}[h!]
\begin{center}
\begin{tabular}{lcc}
\toprule[0.5pt]
\multirow{2}{*}{Atomická akce} & \multicolumn{2}{c}{Dynamická atraktivita pøedmìtu} \\
\cmidrule[0.2pt]{2-3}
 & bez poadované afordance & s poadovanou afordancí \\

\midrule[0.2pt]

Remember & 0 & 0 \\

LookForObject & 0 & 0 \\

MoveToPartial & 1 & 1 \\

Explore & 0,5 & 1 \\

ExecuteReal & 0,5 & 0,75 \\

\bottomrule[0.5pt]
\end{tabular}\\
\end{center}
\centering
\caption{Dynamická atraktivita pøedmìtu v závislosti na atomické akci}
\label{tab:act-attr}
\end{table}


Pokud je fantom pøedmìtu ji v percepèním poli, intenzita fantomu stoupne o aktuální atraktivitu pøedmìtu.
Pokud není, je vytvoøen novı fantom a pøidán do percepèního pole s intenzitou odpovídající aktuální atraktivitì pøedmìtu.
Pøidání fantomu však není propagováno hned dále (do prostorové mapy a procesní èásti).
Kdy jsou zpracovány všechny pøedmìty, které agent v tomto kroku vidìl, jsou fantomy v percepèním poli seøazeny dle intenzity.
Pokud je fantomù více ne velikost percepèního pole, jsou fantomy s nejniší intenzitou z pole odstranìny.
Teprve nyní jsou novì pøidané fantomy pøedány prostorové mapì a procesní
èásti\footnote{Do prostorové mapy a procesní èásti jsou tedy pøedány pouze ty fantomy, které se vešly do percepèního pole.}.
\\
