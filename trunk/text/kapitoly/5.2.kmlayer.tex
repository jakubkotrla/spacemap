\section{Model zaloenı na Kohonenovì mapì}

Vìtšina modelù pamìti, zmínìnıch v tøetí kapitole, vyuívá samoorganizaèní Kohonenovy mapy \cite{litKohonen}.
Kohonenova mapa je model neuronové sítì uèící se bez uèitele, vyuívá soutìní strategii uèení.
Neurony jsou v Kohonenovì mapì uspoøádány do nìjaké topologické struktury, nejèastìji do dvourozmìrné møíky.
Tím je urèeno, jaké neurony spolu sousedí.
Okolím neuronu $N_s(c)$ velikosti $s$ neuronu $c$ pak rozumíme jeho sousedy a další neurony, jejich vzdálenost v topologii je menší ne $s$:

\begin{equation} 
N_s(c) = \{j:d(j,c)\leq s\}
\label{formula:km-okoli}
\end{equation}

kde $d(j,c)$ je vzdálenost v topologické struktuøe.
Neurony Kohonenovy mapy pøi uèení souteí o to, kterı z nich bude aktivní pøi daném vstupu.
Vítìznın neuronem se stane ten, kterı se nejvíce podobá vstupu. Jeho váha a váhy neuronù v jeho okolí jsou upraveny.
Ostatní neurony jsou neaktivní a neuèí se. Kohonenova mapa a další modely samoorganizaèních map jsou popsány napø. v \cite{litSimaNeruda}.
\\

Kohonenova mapa by mìla splòovat naše poadavky. Umí rozmístit uzly do hustoty odpovídající rozmístìní pøedmìtù v prostoru.
Umí se uèit online, kadı vjem agenta je moné chápat jako prvek trénovací mnoiny dat. Jeví se tedy jako ideální.
Navrhli jsme tedy model vrstvy uzlù zaloenı na Kohonenovì mapì.
\\

?? definice vsech parametru ??
\\

\begin{figure}[h]
  \centering
  \includegraphics[width=0.5\textwidth]{img/kml/kml-start-grid.eps}
  \caption{Poèáteèní pokrytí svìta uzly}
  \label{fig:kml-start}
\end{figure}


Na zaèátku je prostor pokryt Kohonenovou mapou - ètvercovou sítí. Hustota uzlù je parametr modelu.
Pokadé, kdy je vjem pøedán ke zpracování, provede se trénování Kohonenovy mapy dle algoritmu \ref{alg:km-uceni}.
\\


\begin{algorithm}[h!]
\caption{Zpracování vjemu}
\label{alg:km-uceni}
\begin{algorithmic}[1]
\State $node \gets$ vyhrávající uzel (nejbliší k poloze vjemu)
\State $queue \gets \emptyset$
\State $queue \gets node$
\While{$queue\not= \emptyset$}
	\State $n \gets first(queue)$
	\State $queue \gets queue  \setminus {n}$
	\State Zmìna polohy $n$ dle vzorce \ref{formula:km-uceni} \label{alg:km-uceni-vzorec}
	\State $queue \gets$ sousedi $n$ (pokud nebyli ješte trénováni)
\EndWhile
\State vjem je pøedán vrstvì uzlù k dalšímu zpracování
\end{algorithmic}
\end{algorithm}

V algoritmu je na øádce \ref{alg:km-uceni-vzorec} zmìnìna poloha uzlu mapy. Uzel je posunut smìrem k poloze vjemu o \(\Delta xy(n, vjem)\) dle vzorce:

\begin{equation} 
\Delta xy(n, vjem) = coef_{neighbour}(n, node) \times coef_{learn} \times dist(n, vjem)
\label{formula:km-uceni}
\end{equation}

kde \(coef_{neighbour}\) je vzdálenost mezi vyhrávajícím uzlem a právì trénovanım uzlem v Kohonenovì mapì,
\emph{dist} je vzdálenost uzlu od vjemu v prostoru a \(coef_{learn}\) je parametr modelu.
Vzorec \ref{formula:km-uceni} je analogií uèení Kohonenovy mapy.
\\

Tímto algoritmem by se mìla prostorová mapa v prùbìhu simulace nauèit rozloení pøedmìtù ve svìtì a pøizpùsobit se mu.
Uzly mapy se postupnì pøesunou do míst s velkou èetností vjemù a rozloení uzlù by se tak mìlo v èase postupnì blíit rozloení pøedmìtù.
\\

\begin{figure}
  \centering
  \subfloat[Po 1000 krocích]{\label{fig:kml-preuceni-1}\includegraphics[width=0.5\textwidth]{img/kml/kml-preuceni-1.eps}}
  \subfloat[Po 4000 krocích]{\label{fig:kml-preuceni-2}\includegraphics[width=0.5\textwidth]{img/kml/kml-preuceni-2.eps}}
  \caption{Test modelu}
  \label{fig:kml-preuceni}
\end{figure}

Test modelu (obrázek \ref{fig:kml-preuceni}) ukázal, e k tomu skuteènì dojde, ale více, ne bychom chtìli.
Problém, kterı nastal, je e se sí pro naše potøeby "pøeuèila" 
%\footnote{jedná se analogii pøeuèení neuronové sítì}
 - uzly se èasem všechny pøesunuli k pøedmìtùm a prostor bez pøedmìtù zùstal prázdnı, bez uzlù.
Navrhli jsem dvì øešení:
\begin{CompactItemize}
\item Base objects - pøidání umìlıch objektù, které se budou snait dret pùvodní rozloení uzlù Kohonenovy mapy
\item Odpudivost uzlù - uzly mapy se budou vzájemnì odpuzovat, aby se nenahromadily všechny na jedno místo
\end{CompactItemize}

Vıše zmínìná øešení jsme vyzkoušeli v jednoduché ètvercové místnosti.
\\

\subsection{Base objects}
Toto øešení pøidává do svìta umìlé pøedmìty, tzv. base objects.
Tyto umìlé pøedmìty musí mít niší atraktivitu ne reálné pøedmìty, aby je nepøebily a mapa se mohla nìco nauèit.
\\

Base objects jsou do svìta pøidány na zaèátku, pøi vytváøení ètvercové sítì. V kadém místì, kde je uzel sítì, je vytvoøen jeden base object.
Agent je bude vnímat stejnì jako ostatní pøedmìty, v prùbìhu simulace budou k sobì pøitahovat uzly sítì stejnì jako reálné pøedmìty.
Tím by mìly udret Kohonenovu mapu roztaenou i v místech, kde reálné pøedmìty nejsou.
\\

\begin{figure}
  \centering
  \subfloat[Po 500 krocích]{\label{fig:kml-bo-1}\includegraphics[width=0.5\textwidth]{img/kml/bo-0.5-0500.eps}}
  \subfloat[Po 1000 krocích]{\label{fig:kml-bo-2}\includegraphics[width=0.5\textwidth]{img/kml/bo-0.5-1000.eps}}
  \caption{Test modelu s base objects}
  \label{fig:kml-baseobjs}
\end{figure}

Vısledek testu je na obrázku \ref{fig:kml-baseobjs}.
\footnote{Další vısledky testù s rùznou hodnotou atraktivity base objects jsou na pøiloeném CD ??}
Ukazuje, e øešení nevyhovuje. Mapa se stahuje do støedu místnosti bez ohledu na vliv base objects.
Dùvodem je to, e tìištì všech base objects je ve støedu místnosti.
Tomu bychom mohli na první zabránit zvıšením atraktivity base objects, které jsou na kraji místnosti.
Jednoduchım protipøíkladem takového øešení je místnost, která bude mít objekty pouze na kraji (na zdech, v rozích).
Pak bychom potøebovali zvıšit atraktivitu base objects uprostøed místnosti resp. obecnì bychom museli zvıšit atraktivitu base objects v místech,
kde nejsou reálné pøedmìty.
Tím jsme pøevedli pùvodní problém na problém opaènı. Øešení s pouitím base objects tedy nevyhovuje.
\\

\subsection{Odpudivost uzlù} \label{s:km-odpudivost}
Do modelu jsme pøidali vzájemnou odpudivost uzlù sítì. V kadém kroku simulace se uzly, které jsou pøíliš blízko u sebe, odpuzují.
Vzájemná odpudivost dvou uzlù závisí na jejich vzdálenosti a jejich naplnìnosti.
\\

\begin{definition}[Naplnìnost uzlu]
Uzel prostorové mapy má vazby na pamìové stopy. Naplnìnost uzlu je souèet intenzit všech jeho vazeb na pamìové stopy.
Pøedstavuje míru dùleitosti uzlu pro pamì na pøedmìty.
Èím více pamìovıch stop vyuívá uzel a èím intenzivnìjší jsou, tím ménì by se mìla mìnit jeho poloha.
Uzel s vysokou naplnìností bude v místì, kde je hodnì pøedmìtù.
V takovıch místech by hustota uzlù mìla bıt vìtší a proto je nutné, aby v takovıch místech byla vzájemná odpudivost uzlù menší.
Naplnìnost uzlu $node$ budeme dále ve vzorcích oznaèovat znakem $\mu(node)$
\end{definition}

\begin{equation} 
odpudivost(n_i, n_j) = \frac{ coef }{ dist(n_i, n_j)^2 \times \mu(n_i) \times \mu(n_j) } 
\label{formula:km-odpudivost}
\end{equation}
\\

Naplnìnost uzlu lze pøi urèování vzájemné odpudivosti chápat jako analogii k hmotnosti tìles, s tím rozdílem,
e odpudivost dvou uzlù je nepøímo úmìrná souèinu jejich naplnìností. Odpudivost je dána vzorcem \ref{formula:km-odpudivost},
kde \emph{coef} je parametr modelu.
V kadém kroku simulace je spoètena vzájemná odpudivost uzlù. Tím jsou urèeny všechny odpudivé síly, které na uzly pùsobí.
Poloha uzlù je pak upravena dle tìchto sil.
\\

\begin{equation} 
\Delta_{xy}(node) = \frac{
\sum_{\substack{
   n \in nodes
  }}
  odpudivost(n, node)
}{ max(1, \mu(node)) } 
\label{formula:el-odpudivost}
\end{equation}
\\


\begin{figure}
  \centering
  \subfloat[Celá místnost s naznaèenım vıøezem]{\label{fig:kml-ag-cele}\includegraphics[height=0.35\textwidth]{img/kml/ag-cele.eps}}
  \qquad
  \subfloat[Vıøez]{\label{fig:kml-ag-vyrez}\includegraphics[height=0.35\textwidth]{img/kml/ag-vyrez.eps}}
  \caption{Test modelu s odpudivostí}
  \label{fig:kml-ag}
\end{figure}

Vısledek testu je na obrázku \ref{fig:kml-ag}.
\footnote{Další vısledky testù s rùznou hodnotou ??AGcoef ?? jsou na pøiloeném CD ??}
Ukazuje, e odpudivé síly deformují Kohonenovu mapu do stavu, kdy její následující uèení nedává smysl.
Sí se pøekroutí tak, e uzly (na obrázku \ref{fig:kml-ag} èervenì vyznaèené), které jsou ve virtuálním svìtì vedle sebe, jsou v síti daleko a obrácenì.
\\

Døíve zmínìnı problém pøeuèení skuteènì nastal a dvì rozdílná øešení jej nedokázala uspokojivì vyøešit. Model zaloenı na Kohonenovì mapì jsme tedy zamítli.
\\