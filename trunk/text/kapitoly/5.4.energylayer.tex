\section{Gravitaèní model}Inspirováni pouitím odpudivosti v pøedchozím modelu, rozhodli jsme se vytvoøit model zaloenı pouze na pøitalivosti a odpudivosti.Tedy uzly mapy jsou pøitahovány k pøemìtùm a zároveò se vzájemnì odpuzují. Obì síly berou v potaz naplnìnost uzlu definovanou v pøedchozí kapitole.\\Model dále obsahuje myšlenku, e i kdy èlovìk vnímá pøedmìty v jeden okamik, ukládání do pamìti probíhá postupnì. \\??? Odkaz na literaturu ???\\Tato myšlenka je to modelu zapracována tak, e vjem je sice dodán prostorové mapì v jeden konkrétní krok simulace,ale mapa si jej uloí a uèí se dle nìj nìkolik následujících krokù.\\\subsection{Vytvoøení uzlù a jejich poèet}Na zaèátku je prostor pokryt uzly. Uzly mohou bıt umístìny zcela náhodnì èi pravidelnì ve ètvercové møíce s náhodnou odchylkou.Toto chování je urèeno parametrem ELCreateNoise, kterı pøedstavuje odchylku vytváøenıch uzlù od pravidelné ètvercové møíky.Je popsáno v tabulce \ref{tab:el-nodeplacement}.\begin{table}[h!]\begin{center}\begin{tabular}{|p{3cm}|p{7cm}|}\hlineELCreateNoise & poèáteèní rozmístìní uzlù \\\hline-1 & zcela náhodné \\\hline0 & pravidelnì ve ètvercové møíce \\\hline$<$ ELDensity & ve ètvercové møíce, kadı uzel se mùe odchılit ve smìru $x$ i $y$ o \mbox{$d \in <$-ELCreateNoise,ELCreateNoise$>$} \\\hline$\geq$ ELDensity & zcela náhodné \\\hline\end{tabular}\\\end{center}\centering\caption{Umístìní uzlù v závisloti na parametru ELCreateNoise}\label{tab:el-nodeplacement}\end{table}?? OBR zacatku - ruzne nastaveni ELCreateNoise ??\\Poèet uzlù, které jsou do prostoru umístìny, je dán parametrem modelu, ELDensity,dle vzorce \ref{formula:pocet-uzlu}, kde $obsah(mistnost)$ je obsah polygonu reprezentující místnost mapovanou Energy Layer.\begin{equation} pocet = \frac{obsah(mistnost)}{ELDensity^2}\label{formula:pocet-uzlu}\end{equation}\\Je ádoucí, aby se poèet uzlù prostorové mapy  v prùbìhu simulace mìnil, dle poètu pøedmìtù, které agent vidìl.Mapa tedy vytváøí nové uzly a zapomíná existující uzly. Pro tuto funkènost jsme definovali nìkolik promìnnıch.\\\emph{Chtìnı poèet uzlù} $n_{desired}$ je poèet uzlù, které by v prostoru mìly bıt, urèenı jen dle jeho velikosti.Je to konstanta, dvojnásobek poètu uzlù, které jsou do prostoru umístìny na zaèátku.\\Cena za pøidání uzlu $cost_{create}$ resp. cena za zapomenutí uzlu $cost_{delete}$ je funkce $n_{desired}$ a aktuálního poètu uzlù $n_{current}$.Jsou urèeny vzorcem:\begin{equation} cost_{create}(n_{desired}, n_{current}) = 100 \times 3^{ \frac{n_{diff}}{50} }\label{formula:cost-create}\end{equation}resp.\begin{equation} cost_{delete}(n_{desired}, n_{current}) = 100 \times 3^{ - \frac{n_{diff}}{50} }\label{formula:cost-delete}\end{equation}\\$n_{diff}$ je promìnná vyjadøující rozdíl mezi aktuálním poètem a chtìnnım poètem uzlù dle vzorce:\begin{equation} n_{diff}(n_{desired}, n_{current}) = NodeCostCoef \times \frac{ n_{current} - n_{desired} }{ n_{desired} }\label{formula:pocet-uzlu}\end{equation}\\?? OBR grafy funkcí ??\\Uzly jsou vytváøeny pøi zpracování vjemu prostorovou mapou. Pravdìpodobnost, e bude uzel vytvoøen, závisí na NodeCreateCost a intenzitì vjemu.Je to podrobnì popsáno v další podkapitole.Zapomenutí uzlu se mùe stát v kadém kroku simulace. Energy Layer akumuluje tzv. energii na zapomínání.Na zaèátku je rovná nule a v prùbìhu simulace roste \footnote{kadı krok je pøièteno mnoství urèené parametrem modelu ELForgetNodeRate}.V kadém kroku je urèena pravdìpodobnost, e bude zapomenut uzel vzorcem:\begin{equation} p_{forget} = \frac{e_{forget} - cost_{delete}}{cost_{delete}}\label{formula:pocet-uzlu}\end{equation}\\?? prepsat na algoritmus ??\\kde $e_{forget}$ je aktuální energie na zapomínání Enery Layer a $cost_{delete}$ je cena za zapomenutí uzlu.Dále je vygenerováno náhodné èíslo $r \in <0,1>$. Pokud je menší ne $p_{forget}$, dojde k zapomenutí uzlu.Energie na zapomínání je sníena o aktuální NodeDeleteCost a je vybrán náhodnı uzel.Ten je odstranìn z prostorové mapy vèetnì všech jeho vazeb na pamìové stopy.\\V ten okamik mùe dojít a typicky dochází k narušení nauèeného rovnomìrného rozloení uzlù v prostoru, smazanı uzel za sebou nechává prázdné místo.Èást prostorové mapy kolem smazaného uzlu by bylo vhodné pøeuèit, pøemistit uzly, aby byly opìt rovnomìrnì rozdìlené.Proto je pøi smazání uzlu provedeno nìkolik lokálních krokù simulace, kdy je provádìno pouze odpuzování uzlù v okolí smazaného uzlu.Velikost okolí, tj. uzly, jejich poloha se mìní, a poèet lokálních krokù simulace jsou parametry modelu.\\\subsection{Body energie}Energy Layer se uèí z vjemù postupnì. K tomu vyuívá tzv. \emph{body energie}.Jsou vytváøeny pøi zpracování vjemu prostorovu mapou.Pøedstavují  urèitou míru pozornosti, kterou agent vìnuje jednomu objektu, krátkodobì uloenı vjem, kterı chvíli trvá a prostorovou mapu postupnì mìní.\\Bod energie je trojice \emph{$<$poloha, pamìová stopa, energie$>$}, kde energie urèuje míru s jakou bude bod ovlivòovat prostorovou mapu.Pøi vytvoøení je jeho energie nastavena dle síly vjemu.V následujících krocích simulace je spotøebována na vytváøení novıch uzlù mapy a na její uèení, tj. pøitahování uzlù.Mnoství energie v èase klesá, klesne-li pod mez, danou jako parametr modelu, bod energie zmizí.\\Zpracování pøíchozího vjemu v Energy Layer je tedy pouze vytvoøení bodu energie v místì vjemu s odkazem na pamìovou stopu.Pokud v daném místì ji bod je, jeho mnoství energie je zvıšeno. Poèáteèní energie bodu resp. zvıšení energie je dáno vzorcem:\begin{equation} p_{energy} = EPCreateEnergy \times \eta(vjem)\label{formula:el-ep-energy}\end{equation}\\V kadém kroku simulace je pro kadı bod energie proveden algoritmus \ref{alg:ep-step}.\begin{algorithm}[h!]\caption{Jeden krok simulace pro bod energie}\label{alg:ep-step}\begin{algorithmic}[1]\State $p_{create} \gets$ pravdìpodobnost vzniku nového uzlu daná vzorcem \ref{formula:el-pst-node-create} \label{alg:ep-step-create}\State $r \gets$ náhodné èíslo $r \in <0,1>$\If{$r < p_{create}$}	\State vytvoøení nového uzlu	\State vytvoøení vazby uzlu na pamìovou stopu bodu energie	\State $bod_{energy} \gets bod_{energy} - cost_{create}$ \label{alg:ep-step-cost}\EndIf\State $nodes \gets$ všechny uzly v okolí bodu energie\ForAll{$node \in nodes$}	\State $node_{xy} \gets node_{xy} + \Delta_{xy}$ dle vzorce \ref{formula:el-ep-gravitace} \label{alg:ep-step-gravitace}\EndFor\ForAll{$node \in nodes$}	\State $\Delta \eta \gets \eta(node, bod)$ dle vzorce \ref{formula:el-intenzita} \label{alg:ep-step-intenzita}	\State zvıšení intenzity vazby mezi $node$ a pamìovou stopou bodu o $\Delta \eta$\EndFor\State $bod_{energy} \gets bod_{energy} \times$ EPFadeCoef\If{$bod_{energy} <$ EPFadeLimit}	\State zrušení bodu energie\EndIf\end{algorithmic}\end{algorithm}Na øádku \ref{alg:ep-step-create} je pouita pravdìpodobnost vytvoøení nového uzlu z energie bodu. Ta je dána vzorcem:\begin{equation} p_{create}(bod_{energy}, cost_{create}) = \frac{bod_{energy} - cost_{create}}{cost_{create}}\label{formula:el-pst-node-create}\end{equation}\\Cena za vytvoøení uzlu $cost_{create}$ ve vzorci \ref{formula:el-pst-node-create}a na øádku \ref{alg:ep-step-cost} algoritmu je urèena vzorcem \ref{formula:cost-create}.Na øádku \ref{alg:ep-step-gravitace} je pouita zmìna polohy uzlu $\Delta_{xy}$, je dána vzorcem:\begin{equation} \Delta_{xy}(node, bod) = \frac{bod_{energy}}{EPCreateEnergy} \times \frac{ ELGravityCoef }{ dist(node, bod)^2 \times \mu(node) }\label{formula:el-ep-gravitace}\end{equation}\\Na øádku \ref{alg:ep-step-intenzita} je zvıšena intenzita vazby mezi uzlem a pamìovou stopu.Zvıšení je dáno podobnım vzorcem jako \ref{formula:intenzita-vazby} s jedinım rozdílem, e místo vjemu se pracuje s bodem energie:\begin{equation} \Delta \eta(node, bod) = bod_{energy} \times \frac{ norm( dist(node, bod) ) }{\sum_{n \in nodes}  norm( dist(n, bod) )}\label{formula:el-intenzita}\end{equation}\\kde \emph{nodes} je mnoina všech uzlù v okolí bodu a $dist$ je vzdálenost uzlu od bodu.Funkce $norm$ je libovolná klesající funkce mající obor hodnot $<0,1>$, napø. nepøímá úmìra $norm(x) = 1/max(1,x)$ èi Gaussova funkce.\\Ve vzorci \ref{formula:el-ep-gravitace} je pouita naplnìnost uzlu.Stejnì jako v kapitole \ref{s:km-odpudivost} se jedná o míru nauèenosti uzlu, jeho dùleitosti pro pamì na pøedmìty.Uzel s vysokou naplnìností bude mìnit svoji polohu ménì ne uzel s nízkou naplnìností.\\V modelu Energy Layer není naplnìnost uzlu prostı souèet intenzit všech jeho vazeb na pamìové stopy, ale vlastnost uzlu.Pøi vytvoøení uzlu na zaèátku simulace je nastavena na nulu,pøi vytvoøení uzlu v prùbìhu simulace jako vısledek zpracování vjemu je nastavena dle parametru modelu MemObjIntenseToNewNode.\\Naplnìnost uzlu se mìní ve dvou pøípadech:\begin{CompactItemize}\item kdy je zvıšena intenzita vazby mezi uzlem a pamìovou stopou, je stejnì zvıšena i naplnìnost uzlu\item kadı krok simulace je naplnìnost uzlu sníena dle parametru modelu ELNodeUsageFadeOut\end{CompactItemize}\subsection{Odpudivost uzlù}V kadém kroku simulace se uzly, které jsou pøíliš blízko u sebe, odpuzují.Vdy je spoètena vzájemná odpudivost kadıch dvou uzlù dle vzorce:\begin{equation} odpudivost(n_i, n_j) = \frac{ ELAntigravityCoef }{ dist(n_i, n_j)^2 \times \mu(n_i) \times \mu(n_j) } \label{formula:el-odpudivost}\end{equation}\\Naplnìnost uzlù musí bıt minimálnì 0,8 a celı jmenovatel ve vzorci \ref{ormula:el-odpudivost} musí bıt minimálnì 0,64.K tomu je vyuita funkce $max$, kterou pro pøehlednost ve vzorci není.Zabráníme tak dìlení nulou a pøíliš velkım hodnotám odpudivosti, kdy by se jmenovatel bllíil nule.\\Po urèení všech odpudivıch sil, které na uzly pùsobí, jsou polohy uzlù upraveny dle tìchto sil a jejich aktuální naplnìnosti:\begin{equation} \Delta_{xy}(node) = \frac{\sum_{\substack{   n \in nodes  }}  odpudivost(n, node)}{ max(1, \mu(node)) } \label{formula:el-odpudivost}\end{equation}\\Funkce $max$ je ve vzorci pouita, aby zabránila dìlení nulou a pøíliš velkım zmìnám polohy uzlù pro $\mu(node) \to 0$.Pøesto je moné, e se v jednom kroku simulace nasèítají takové odpudivé a pøitalivé síly, e by zmìna polohy uzlu mohla pøesáhnout rozumnou mez.Nechceme, aby kvùli krátkodobım stavùm sítì \footnote{napø. pøi vytvoøení nového uzlu prostorové mapy} uzly pøíliš mìnily svou polohu.Pøidali jsme tedy omezení na maximální monı pohyb uzlu - parametr modelu MaxELNodeMove.Alternativní øešení by bylo zmenšit parametr ELAntigravityCoef a ELGravityCoef a provést více iterací algoritmu \ref{alg:ep-step}. To jevšak velmi nároèné na vıkon a vıše uvedené øešení toto vlastnì imituje.\\\subsection{Omezení pohybu uzlù}Následkem odpudivosti uzlù je moné, e se model bude snait pøesunout uzel mimo svìt, resp. vnì polygonu svìt reprezentující.V tom pøípadì je uzel na okraj svìta, tj. na hranu polygonu v místì jejího prùseèíku s úseèkou pøedstavující plánovanou trajektorií uzlu.Pokud se v dalších krocích simulace bude model opìt snait pøesunout uzel vnì polygonu, bude jeho trajektorie promítnuta na hranu polygonu, na které uzel leí.Uzel tak bude "klouzat" po hranì polygonu, jak je ukázáno na obrázku \ref{fig:slide-on-edge}.\\\begin{figure}[h]  \centering  \scalebox{0.8}{\includegraphics{img/slide-on-edge.ps}}  \caption{Zmìna posunu uzlu, kdy narazí na hranu polygonu}  \label{fig:slide-on-edge}\end{figure}\subsection{Hiearchie}Jedním z poadavkù na model vrstvy uzlù je, aby umìl vytváøet hiearchii uzlù. Model musí bıt schopen rozpoznat místa s vyšší hustotou uzlù.\\Uzlùm prostorové mapy pøidáme další vlastnost \emph{AGamount}, mnoství odpudivosti, které uzel za svoji existenci pocítil.Pøi vytvoøení uzlu je nastavena na nulu. V kadém kroku pøi poèítání odpudivıch sil pùsobících na uzel, je zvıšena o:\begin{equation} \Delta_{AGamount}(node) = \sum_{ 	\substack{		n \in nodes	}}  |odpudivost(n, node)|\label{formula:el-agamount}\end{equation}\\Mnoství odpudivosti v uzlu je sledováno a kdy pøekroèí limit danı modelem, parametr HLAGNeeded, algoritmus \ref{alg:hl-create} vytvoøí novı uzel vyšší úrovnì.\\ToDo\\